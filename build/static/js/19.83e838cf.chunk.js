(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[19],{115:function(e,t,a){"use strict";a.r(t);var l=a(11),n=a(0),s=a.n(n),c=a(40),r=a(45),m=a(17),o=a(44);var i=function(e){let{isOpen:t,onClose:a,onRequestCreated:r}=e;const[o,i]=Object(n.useState)({its:"",type:"",meta:"",city:null,zone:null,toggle:null,pass_date:null}),[u,d]=Object(n.useState)(!1),[p,b]=Object(n.useState)({}),[y,E]=Object(n.useState)([]),[g,h]=Object(n.useState)([]),[x,v]=Object(n.useState)([]),[f,N]=Object(n.useState)(!1),[C,k]=Object(n.useState)(!1),[j,_]=Object(n.useState)(!1);Object(n.useEffect)(()=>{t&&((async()=>{N(!0);try{const e=await Object(c.c)("/users/permissions/");E(Array.isArray(e)?e:[])}catch(e){b(e=>Object(l.a)(Object(l.a)({},e),{},{fetchPerms:"Failed to load permissions"}))}finally{N(!1)}})(),(async()=>{k(!0);try{const e=await Object(c.c)("/requests/cities");h(Array.isArray(e.results)?e.results:[])}catch(e){b(e=>Object(l.a)(Object(l.a)({},e),{},{fetchCities:"Failed to load cities"}))}finally{k(!1)}})(),(async()=>{_(!0);try{const e=await Object(c.c)("/requests/zones");v(Array.isArray(e.results)?e.results:[])}catch(e){b(e=>Object(l.a)(Object(l.a)({},e),{},{fetchZones:"Failed to load zones"}))}finally{_(!1)}})())},[t]);const w=e=>{const{name:t,value:a}=e.target;i(e=>Object(l.a)(Object(l.a)({},e),{},{[t]:a}))},O=async e=>{if(e.preventDefault(),(()=>{const e={};return/^\d{8}$/.test(o.its.trim())||(e.its="ITS must be an 8-digit number."),"pass_request"===o.type&&(o.toggle||(e.toggle="Please select waaz or majlis or bethak."),o.pass_date||(e.pass_date="Please pick a pass_date.")),"change_city_request"===o.type&&(o.city||(e.city="Please select a city.")),"change_zone_request"===o.type&&(o.zone||(e.zone="Please select a zone.")),b(e),0===Object.keys(e).length})())try{d(!0),await Object(c.e)("/requests/create-request/",o),i({its:"",type:"",meta:"",city:null,zone:null,toggle:null,pass_date:null}),r&&r(),a()}catch(n){var t;console.error(n);const e=(null===(t=n.response)||void 0===t?void 0:t.data)?"Failed to create request. Check the form.":"Failed to create request. Try again.";b(t=>{var a;return Object(l.a)(Object(l.a)({},t),{},{submit:e},null===(a=n.response)||void 0===a?void 0:a.data)})}finally{d(!1)}};Object(n.useEffect)(()=>{t||(i({its:"",type:"",meta:"",city:null,zone:null,toggle:null,pass_date:null}),b({}))},[t]);const{type:q}=o;return s.a.createElement(m.Modal,{isOpen:t,onClose:a},s.a.createElement(m.ModalHeader,null,"Add New Request"),s.a.createElement(m.ModalBody,null,s.a.createElement("form",{onSubmit:O},s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"ITS *"),s.a.createElement(m.Input,{name:"its",value:o.its,onChange:w,placeholder:"Enter 8-digit ITS",maxLength:8}),p.its&&s.a.createElement("span",{className:"text-xs text-red-600"},p.its))),s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"Type *"),s.a.createElement(m.Select,{name:"type",value:o.type,onChange:w,disabled:f},s.a.createElement("option",{value:""},"Select a permission"),y.map((e,t)=>s.a.createElement("option",{key:t,value:e.code},e.description||e.code))),p.type&&s.a.createElement("span",{className:"text-xs text-red-600"},p.type))),"change_city_request"===q&&s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"City *"),s.a.createElement(m.Select,{name:"city",value:o.city,onChange:w,disabled:C},s.a.createElement("option",{value:""},"Select a city"),g.map((e,t)=>s.a.createElement("option",{key:t,value:e.id||e.code||e},e.name||e.description||e))),p.city&&s.a.createElement("span",{className:"text-xs text-red-600"},p.city))),"change_zone_request"===q&&s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"Zone *"),s.a.createElement(m.Select,{name:"zone",value:o.zone,onChange:w,disabled:j},s.a.createElement("option",{value:""},"Select a zone"),x.map((e,t)=>s.a.createElement("option",{key:t,value:e.id||e.code||e},e.name||e.description||e))),p.zone&&s.a.createElement("span",{className:"text-xs text-red-600"},p.zone))),"pass_request"===q&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"Waaz/Majlis/Bethak *"),s.a.createElement("div",{className:"mt-1 space-x-4"},s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"waaz",checked:"waaz"===o.toggle,onChange:w,className:"form-radio"}),s.a.createElement("span",{className:"ml-2"},"Waaz")),s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"majlis",checked:"majlis"===o.toggle,onChange:w,className:"form-radio"}),s.a.createElement("span",{className:"ml-2"},"Majlis")),s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"bethak",checked:"bethak"===o.toggle,onChange:w,className:"form-radio"}),s.a.createElement("span",{className:"ml-2"},"Bethak"))),p.toggle&&s.a.createElement("span",{className:"text-xs text-red-600"},p.toggle))),s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"Date *"),s.a.createElement(m.Input,{type:"date",name:"pass_date",value:o.pass_date,onChange:w}),p.pass_date&&s.a.createElement("span",{className:"text-xs text-red-600"},p.pass_date)))),s.a.createElement("div",{className:"mb-4"},s.a.createElement(m.Label,null,s.a.createElement("span",null,"Meta"),s.a.createElement("textarea",{name:"meta",value:o.meta,onChange:w,className:"w-full px-3 py-2 border rounded-md text-sm",placeholder:"Additional info (optional)"}))),p.fetchPerms&&s.a.createElement("p",{className:"text-red-600 mb-2"},p.fetchPerms),p.fetchCities&&s.a.createElement("p",{className:"text-red-600 mb-2"},p.fetchCities),p.fetchZones&&s.a.createElement("p",{className:"text-red-600 mb-2"},p.fetchZones),p.submit&&s.a.createElement("p",{className:"text-red-600 mb-2"},p.submit))),s.a.createElement(m.ModalFooter,null,s.a.createElement(m.Button,{onClick:O,disabled:u},u?"Saving...":"Save Request")))};var u=function(e){let{isOpen:t,onClose:a,onRequestUpdated:r,requestData:o}=e;const[i,u]=Object(n.useState)({its:"",type:"",meta:"",city:"",zone:"",toggle:"",pass_date:""}),[d,p]=Object(n.useState)([]),[b,y]=Object(n.useState)([]),[E,g]=Object(n.useState)([]),[h,x]=Object(n.useState)({}),[v,f]=Object(n.useState)(!1),[N,C]=Object(n.useState)(!1),[k,j]=Object(n.useState)(!1),[_,w]=Object(n.useState)(!1);Object(n.useEffect)(()=>{if(!t)return S();const e=async(e,t,a,n)=>{n(!0);try{const a=await Object(c.c)(e);t(Array.isArray(a.results)?a.results:Array.isArray(a)?a:[])}catch(s){a(t=>Object(l.a)(Object(l.a)({},t),{},{[e]:"Failed to load ".concat(e)}))}finally{n(!1)}};e("/users/permissions/",p,x,f),e("/requests/cities",y,x,C),e("/requests/zones",g,x,j)},[t]),Object(n.useEffect)(()=>{t&&o&&u({its:o.its||"",type:o.type||"",meta:o.meta||"",city:o.city||null,zone:o.zone||null,toggle:o.toggle||null,pass_date:o.pass_date||null})},[t,o]);const O=e=>{const{name:t,value:a}=e.target;u(e=>Object(l.a)(Object(l.a)({},e),{},{[t]:a}))},q=async e=>{if(e.preventDefault(),(()=>{const e={};return/^\d{8}$/.test(i.its.trim())||(e.its="ITS must be an 8-digit number."),"pass_request"===i.type&&(i.toggle||(e.toggle="Please select waaz or majlis or bethak"),i.pass_date||(e.pass_date="Please pick a date.")),"change_city_request"!==i.type||i.city||(e.city="Please select a city."),"change_zone_request"!==i.type||i.zone||(e.zone="Please select a zone."),x(e),0===Object.keys(e).length})())try{w(!0),await Object(c.d)("/requests/requests/".concat(o.id,"/edit/"),i),"function"===typeof r&&r(),a()}catch(n){var t;const e=(null===(t=n.response)||void 0===t?void 0:t.data)?"Check the fields.":"Try again.";x(t=>{var a;return Object(l.a)(Object(l.a)({},t),{},{submit:e},null===(a=n.response)||void 0===a?void 0:a.data)})}finally{w(!1)}},S=()=>{u({its:"",type:"",meta:"",city:null,zone:null,toggle:null,pass_date:null}),x({})},{type:T}=i;return s.a.createElement(m.Modal,{isOpen:t,onClose:a},s.a.createElement(m.ModalHeader,null,"Edit Request"),s.a.createElement(m.ModalBody,null,s.a.createElement("form",{onSubmit:q},s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"ITS *"),s.a.createElement(m.Input,{name:"its",value:i.its,onChange:O,maxLength:8}),h.its&&s.a.createElement("span",{className:"text-xs text-red-600"},h.its)),s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"Type *"),s.a.createElement(m.Select,{name:"type",value:i.type,onChange:O,disabled:v},s.a.createElement("option",{value:""},"Select a type"),d.map((e,t)=>s.a.createElement("option",{key:t,value:e.code},e.description||e.code))),h.type&&s.a.createElement("span",{className:"text-xs text-red-600"},h.type)),"change_city_request"===T&&s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"City *"),s.a.createElement(m.Select,{name:"city",value:i.city,onChange:O,disabled:N},s.a.createElement("option",{value:""},"Select a city"),b.map((e,t)=>s.a.createElement("option",{key:t,value:e.id||e.code||e},e.name||e.description||e))),h.city&&s.a.createElement("span",{className:"text-xs text-red-600"},h.city)),"change_zone_request"===T&&s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"Zone *"),s.a.createElement(m.Select,{name:"zone",value:i.zone,onChange:O,disabled:k},s.a.createElement("option",{value:""},"Select a zone"),E.map((e,t)=>s.a.createElement("option",{key:t,value:e.id||e.code||e},e.name||e.description||e))),h.zone&&s.a.createElement("span",{className:"text-xs text-red-600"},h.zone)),"pass_request"===T&&s.a.createElement(s.a.Fragment,null,s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"Waaz/Majlis/Bethak *"),s.a.createElement("div",{className:"space-x-4"},s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"waaz",checked:"waaz"===i.toggle,onChange:O}),s.a.createElement("span",{className:"ml-2"},"Waaz")),s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"majlis",checked:"majlis"===i.toggle,onChange:O}),s.a.createElement("span",{className:"ml-2"},"Majlis")),s.a.createElement("label",{className:"inline-flex items-center"},s.a.createElement("input",{type:"radio",name:"toggle",value:"bethak",checked:"bethak"===i.toggle,onChange:O}),s.a.createElement("span",{className:"ml-2"},"Bethak"))),h.toggle&&s.a.createElement("span",{className:"text-xs text-red-600"},h.toggle)),s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"Pass Date *"),s.a.createElement(m.Input,{type:"date",name:"pass_date",value:i.pass_date,onChange:O}),h.pass_date&&s.a.createElement("span",{className:"text-xs text-red-600"},h.pass_date))),s.a.createElement(m.Label,{className:"mb-4"},s.a.createElement("span",null,"Meta"),s.a.createElement("textarea",{name:"meta",value:i.meta,onChange:O,className:"w-full px-3 py-2 border rounded-md text-sm"})),h.submit&&s.a.createElement("p",{className:"text-red-600 mb-2"},h.submit))),s.a.createElement(m.ModalFooter,null,s.a.createElement(m.Button,{onClick:q,disabled:_},_?"Updating\u2026":"Update Request")))},d=a(18),p=a.n(d);a(41),a(48);t.default=function(){const[e,t]=Object(n.useState)(""),[a,d]=Object(n.useState)(""),[b,y]=Object(n.useState)(""),[E,g]=Object(n.useState)(0),[h,x]=Object(n.useState)(""),[v,f]=Object(n.useState)([]),[N,C]=Object(n.useState)(!1),[k,j]=Object(n.useState)([]),[_,w]=Object(n.useState)(!0),[O,q]=Object(n.useState)(null),[S,T]=Object(n.useState)(!1),[z,A]=Object(n.useState)(!1),[B,R]=Object(n.useState)(null),[L,F]=Object(n.useState)(0),[P,M]=Object(n.useState)({}),[U,I]=Object(n.useState)([]),[D,Z]=Object(n.useState)([]),[H,W]=Object(n.useState)([]);Object(n.useEffect)(()=>{(async()=>{try{const e=await Object(c.c)("/requests/filters");I(e.statuses),Z(e.types),W(e.creators)}catch(e){console.error("Failed to load filter options",e)}})();(async()=>{try{w(!0);const t=new URLSearchParams;N||(e&&t.append("status",e),a&&t.append("type",a),b&&t.append("created_by",b));const l=t.toString(),n=N?"requests/filter-requests/":"/requests/requests".concat(l?"?".concat(l):""),s=await Object(c.c)(n),r=(null===s||void 0===s?void 0:s.results)||[];if(N&&r.length&&!Array.isArray(r[0].requests)){const e=r.reduce((e,t)=>{const a="".concat(t.its,"-").concat(t.type);return e[a]||(e[a]={its:t.its,type:t.type,requests:[]}),e[a].requests.push(t),e},{});j(Object.values(e));const t=Object.values(e).map(e=>{var t;return null===(t=e.requests[0])||void 0===t?void 0:t.id}).filter(Boolean);f(t)}else if(j(r),N){const e=r.flatMap(e=>{const t=(Array.isArray(e.requests)?e.requests:[])[0];return(null===t||void 0===t?void 0:t.id)?[t.id]:[]});f(e)}}catch(t){console.error("Error fetching request data:",t),q("Failed to load request data")}finally{w(!1)}})()},[L,e,a,b,L,E,N]);const J=()=>{T(!0)},$=e=>{R(e),A(!0)},G=()=>{C(!0),F(e=>e+1)},K=e=>e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),Q=e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},V=e=>{switch(e){case"todo":return"bg-blue-400 text-white";case"is_batch":return"bg-purple-400 text-white";case"discarded":return"bg-yellow-400 text-white";case"completed":return"bg-green-400 text-white";case"duplicate":return"bg-red-400 text-white";default:return"bg-gray-100 text-white"}},X=async e=>{try{window.confirm("Are you sure you want to delete this request?")&&(await Object(c.a)("/requests/requests/".concat(e,"/delete/")),j(t=>t.filter(t=>t.id!==e)),p.a.success("Request deleted successfully"))}catch(O){p.a.error(O.response.data.error)}};return s.a.createElement("div",{className:"relative w-full px-4 py-6"},s.a.createElement("div",{className:"relative z-10"},"      ",s.a.createElement("div",{className:"flex items-center justify-between mb-6"},s.a.createElement(r.a,null,"Requests"),s.a.createElement("div",{className:"flex space-x-2"},N?s.a.createElement(s.a.Fragment,null,s.a.createElement("input",{type:"text",placeholder:"Enter Batch Name",className:"border px-3 py-2 rounded",value:h,onChange:e=>x(e.target.value)}),s.a.createElement("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:async()=>{try{await Object(c.e)("requests/batch/",{name:h,request_ids:v}),p.a.success("Batch created successfully"),x(""),f([]),C(!1),F(e=>e+1)}catch(e){console.error(e),p.a.error("Failed to create batch")}},disabled:0===v.length||!h.trim()},"Confirm Batch"),s.a.createElement("button",{className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",onClick:()=>{C(!1),x(""),f([]),F(e=>e+1)}},"Cancel")):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"hidden md:block"},s.a.createElement("button",{onClick:G,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"},"Create Batch"),s.a.createElement("button",{onClick:J,className:"px-4 py-2 flex items-center bg-purple-600 text-white rounded-lg"},"Add Request")),s.a.createElement("div",{className:"md:hidden"},s.a.createElement("button",{onClick:G,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"},"Batch"),s.a.createElement("button",{onClick:J,className:"px-4 py-2 mt-2 flex items-center bg-purple-600 text-white rounded-lg"},"Request"))))),!N&&s.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},s.a.createElement("select",{className:"w-full border rounded px-4 py-3 dark:bg-gray-700 dark:text-white dark:border-gray-700",value:e,onChange:e=>t(e.target.value)},s.a.createElement("option",{value:""},"All Statuses"),U.map(e=>s.a.createElement("option",{key:e,value:e},e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())))),s.a.createElement("select",{className:"w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white dark:border-gray-700",value:a,onChange:e=>d(e.target.value)},s.a.createElement("option",{value:""},"All Types"),D.map(e=>s.a.createElement("option",{key:e,value:e},e.replace(/_/g," ")))),s.a.createElement("select",{className:"w-full border rounded px-3 py-2  dark:bg-gray-700 dark:text-white dark:border-gray-700",value:b,onChange:e=>y(e.target.value)},s.a.createElement("option",{value:""},"All Creators"),H.map(e=>{let{created_by__id:t,created_by__username:a}=e;return s.a.createElement("option",{key:t,value:t},a)}))),_?s.a.createElement("div",{className:"flex justify-center my-8"},s.a.createElement("p",{className:"text-gray-700 dark:text-gray-300"},"Loading data...")):O?s.a.createElement("div",{className:"text-center py-8"},s.a.createElement("p",{className:"text-red-600 dark:text-red-400"},O)):s.a.createElement(s.a.Fragment,null,s.a.createElement(m.TableContainer,{className:"hidden md:block mb-8"},s.a.createElement(m.Table,null,s.a.createElement(m.TableHeader,null,s.a.createElement("tr",null,N&&s.a.createElement(m.TableCell,null,"Check"),s.a.createElement(m.TableCell,null,"#"),s.a.createElement(m.TableCell,null,"ITS"),s.a.createElement(m.TableCell,null,"Request Type"),s.a.createElement(m.TableCell,null,"Details"),s.a.createElement(m.TableCell,null,"Created By"),s.a.createElement(m.TableCell,null,"Status"),s.a.createElement(m.TableCell,null,"Actions"),s.a.createElement(m.TableCell,null)," ")),s.a.createElement(m.TableBody,null,k.map((e,t)=>{var a;const n=(Array.isArray(e.requests)?e.requests:[])[0];if(!n)return null;const c=P[t]||!1;return s.a.createElement(s.a.Fragment,{key:"".concat(e.its,"-").concat(e.type)},s.a.createElement(m.TableRow,null,N&&s.a.createElement(m.TableCell,null,s.a.createElement("input",{type:"checkbox",checked:v.includes(n.id),onChange:()=>Q(n.id)})),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm font-semibold"},t+1)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},e.its)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},n.type.replace(/_/g," "))),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},"change_city_request"===n.type&&n.city_name,"change_zone_request"===n.type&&n.zone_name,"pass_request"===n.type&&"".concat(null===(a=n.toggle)||void 0===a?void 0:a.toUpperCase()," - ").concat(n.pass_date))),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},n.created_by)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat(V(n.status))},K(n.status))),s.a.createElement(m.TableCell,null,"todo"===n.status&&s.a.createElement("div",{className:"flex items-center space-x-4"},s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>$(n)},s.a.createElement(o.d,{className:"w-5 h-5"})),s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>X(n.id)},s.a.createElement(o.b,{className:"w-5 h-5"})))),s.a.createElement(m.TableCell,null,e.requests.length>1&&s.a.createElement("button",{onClick:()=>M(e=>Object(l.a)(Object(l.a)({},e),{},{[t]:!e[t]})),className:"text-purple-600 font-medium hover:underline text-sm"},c?"Hide":"Show ".concat(e.requests.length-1," more")))),c&&e.requests.slice(1).map((e,t)=>{var a;return s.a.createElement(m.TableRow,{key:e.id,className:"bg-gray-50 dark:bg-gray-700"},N&&s.a.createElement(m.TableCell,null,s.a.createElement("input",{type:"checkbox",checked:v.includes(e.id),onChange:()=>Q(e.id)})),s.a.createElement(m.TableCell,null),s.a.createElement(m.TableCell,{colSpan:2},s.a.createElement("span",{className:"text-sm"},e.its)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},"change_city_request"===e.type&&e.city_name,"change_zone_request"===e.type&&e.zone_name,"pass_request"===e.type&&"".concat(null===(a=e.toggle)||void 0===a?void 0:a.toUpperCase()," - ").concat(e.pass_date))),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},e.created_by)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat(V(e.status))},K(e.status))),s.a.createElement(m.TableCell,null,"todo"===e.status&&s.a.createElement("div",{className:"flex items-center space-x-4"},s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>$(e)},s.a.createElement(o.d,{className:"w-5 h-5"})),s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>X(e.id)},s.a.createElement(o.b,{className:"w-5 h-5"})))),s.a.createElement(m.TableCell,null))}))})))),s.a.createElement("div",{className:"md:hidden space-y-3",style:{opacity:.8}},0===k.length?s.a.createElement("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400"},"No requests found"):k.map((e,t)=>{var a;const n=(Array.isArray(e.requests)?e.requests:[])[0];if(!n)return null;const c=P[t]||!1;return s.a.createElement("div",{key:"".concat(e.its,"-").concat(e.type,"-").concat(e.status),className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 p-4"},s.a.createElement("div",{className:"flex flex-col space-y-2"},s.a.createElement("div",{className:"flex justify-between"},s.a.createElement("p",{className:"text-sm font-semibold text-gray-800 dark:text-white"},"ITS: ",e.its),s.a.createElement("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat(V(n.status))},K(n.status))),s.a.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-300"},"Type: ",n.type.replace(/_/g," ")),s.a.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-300"},"Created By: ",n.created_by),s.a.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-300"},"change_city_request"===n.type&&"City: ".concat(n.city_name),"change_zone_request"===n.type&&"Zone: ".concat(n.zone_name),"pass_request"===n.type&&"Pass: ".concat(null===(a=n.toggle)||void 0===a?void 0:a.toUpperCase()," - ").concat(n.pass_date))),"todo"===n.status&&s.a.createElement("div",{className:"flex space-x-2 mt-3"},s.a.createElement("button",{onClick:()=>$(n),className:"text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 p-1 rounded"},s.a.createElement(o.d,{className:"h-5 w-5"})),s.a.createElement("button",{onClick:()=>X(n.id),className:"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 p-1 rounded"},s.a.createElement(o.b,{className:"h-5 w-5"}))),e.requests.length>1&&s.a.createElement("div",{className:"mt-3"},s.a.createElement("button",{onClick:()=>M(e=>Object(l.a)(Object(l.a)({},e),{},{[t]:!e[t]})),className:"text-purple-600 font-medium hover:underline text-sm"},c?"Hide":"Show ".concat(e.requests.length-1," more"))),c&&e.requests.slice(1).map(e=>{var a;return s.a.createElement(m.TableRow,{key:e.id,className:"bg-gray-50 dark:bg-gray-700"},N&&s.a.createElement(m.TableCell,null,s.a.createElement("input",{type:"checkbox",checked:v.includes(e.id),onChange:()=>Q(e.id)})),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},t+1)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},e.its)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},e.type.replace(/_/g," "))),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},"change_city_request"===e.type&&e.city_name,"change_zone_request"===e.type&&e.zone_name,"pass_request"===e.type&&"".concat(null===(a=e.toggle)||void 0===a?void 0:a.toUpperCase()," - ").concat(e.pass_date))),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-sm"},e.created_by)),s.a.createElement(m.TableCell,null,s.a.createElement("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat(V(e.status))},K(e.status))),s.a.createElement(m.TableCell,null,"todo"===e.status&&s.a.createElement("div",{className:"flex items-center space-x-4"},s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>$(e)},s.a.createElement(o.d,{className:"w-5 h-5"})),s.a.createElement(m.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>X(e.id)},s.a.createElement(o.b,{className:"w-5 h-5"})))),s.a.createElement(m.TableCell,null)," ")}))}))),s.a.createElement(i,{isOpen:S,onClose:()=>{T(!1)},onRequestCreated:()=>{F(e=>e+1),p.a.success("Request created successfully")}}),B&&s.a.createElement(u,{isOpen:z,onClose:()=>{A(!1),R(null)},onRequestUpdated:()=>{F(e=>e+1),p.a.success("Request updated successfully")},requestData:B})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return r})),a.d(t,"f",(function(){return m})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return u})),a.d(t,"g",(function(){return d}));var l=a(109);let n="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),n="https://rms-v2.duckdns.org/api";const s=l.a.create({baseURL:n,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const c=async(e,t)=>s.get(e,{params:t}).then(e=>e.data),r=async(e,t)=>s.post(e,t).then(e=>e.data),m=async(e,t)=>s.put(e,t).then(e=>e.data),o=async(e,t)=>s.patch(e,t).then(e=>e.data),i=async e=>s.delete(e).then(e=>e.data),u=async(e,t)=>{try{const a=await s.get(e,{responseType:"blob"}),l=new Blob([a.data],{type:"application/pdf"}),n=window.URL.createObjectURL(l),c=document.createElement("a");c.href=n,c.setAttribute("download",t),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(n)}catch(a){throw console.error("Download failed:",a),a}},d=async(e,t)=>{try{return(await s.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}},45:function(e,t,a){"use strict";var l=a(0),n=a.n(l);t.a=function(e){let{children:t}=e;return n.a.createElement("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"},t)}}}]);
//# sourceMappingURL=19.83e838cf.chunk.js.map