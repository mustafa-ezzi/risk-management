(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[15],{118:function(e,t,a){"use strict";a.r(t);var r=a(0),l=a.n(r),c=a(1),n=a(40),s=a(45),d=a(17),o=a(44),m=a(18),i=a.n(m);var u=function(e){let{isOpen:t,onClose:a,onBatchCreated:c}=e;const[s,o]=Object(r.useState)(""),[m,u]=Object(r.useState)([]),[b,p]=Object(r.useState)([]),[y,g]=Object(r.useState)({}),[h,E]=Object(r.useState)(!1);return Object(r.useEffect)(()=>{t&&((async()=>{try{const e=await Object(n.c)("requests/filter-requests");u(Array.isArray(e.results)?e.results:[])}catch(e){console.error("Error fetching requests:",e)}})(),o(""),p([]),g({}))},[t]),t?l.a.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},l.a.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4"},l.a.createElement("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},l.a.createElement(d.ModalHeader,null,"Create New Batch"),l.a.createElement("button",{onClick:a},"\u2716\ufe0f")),l.a.createElement("div",{className:"p-6"},l.a.createElement(d.Label,{className:"block mb-4"},l.a.createElement("span",null,"Batch Name"),l.a.createElement(d.Input,{className:"mt-1",name:"name",value:s,onChange:e=>o(e.target.value),placeholder:"Enter  name",required:!0})),l.a.createElement("div",{className:"mb-4 overflow-x-auto border rounded-md"},l.a.createElement("label",{className:"block text-sm font-medium mb-2 dark:text-white"},"Select Requests *"),l.a.createElement("table",{className:"min-w-full text-sm text-left table-auto"},l.a.createElement("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"},l.a.createElement("tr",null,l.a.createElement("th",{className:"px-3 py-2"},l.a.createElement("input",{type:"checkbox",checked:b.length>0&&b.length===m.length,onChange:e=>p(e.target.checked?m.map(e=>e.id):[])})),l.a.createElement("th",{className:"px-3 py-2"},"ID"),l.a.createElement("th",{className:"px-3 py-2"},"Type"),l.a.createElement("th",{className:"px-3 py-2"},"Status"))),l.a.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600"},m.map(e=>{var t;return l.a.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white"},l.a.createElement("td",{className:"px-3 py-2"},l.a.createElement("input",{type:"checkbox",checked:b.includes(e.id),onChange:()=>{return t=e.id,void p(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}})),l.a.createElement("td",{className:"px-3 py-2"},e.id),l.a.createElement("td",{className:"px-3 py-2"},e.type||"\u2014"),l.a.createElement("td",{className:"px-3 py-2"},"change_city_request"===e.type&&e.city_name,"change_zone_request"===e.type&&e.zone_name,"pass_request"===e.type&&"".concat(null===(t=e.toggle)||void 0===t?void 0:t.toUpperCase()," - ").concat(e.pass_date)))}))),y.requests&&l.a.createElement("p",{className:"text-xs text-red-600 mt-2"},y.requests)),y.submit&&l.a.createElement("p",{className:"text-sm text-red-600"},y.submit)),l.a.createElement("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end"},l.a.createElement("button",{onClick:async()=>{if((()=>{const e={};return s.trim()||(e.name="Name is required"),0===b.length&&(e.requests="At least one request must be selected"),g(e),0===Object.keys(e).length})())try{E(!0),await Object(n.e)("requests/batch/",{name:s,request_ids:b}),i.a.success("Assigned successfully"),"function"===typeof c&&c(),a()}catch(e){console.error("Submit error:",e),g({submit:"Failed to assign. Please try again."})}finally{E(!1)}},disabled:h,className:"px-4 py-2 bg-indigo-600 text-white rounded ".concat(h?"opacity-50":"")},h?"Submitting...":"Assign")))):null};var b=function(e){let{isOpen:t,onClose:a,onBatchUpdated:c,batchData:s}=e;const[o,m]=Object(r.useState)(""),[u,b]=Object(r.useState)([]),[p,y]=Object(r.useState)([]),[g,h]=Object(r.useState)({}),[E,x]=Object(r.useState)(!1);return Object(r.useEffect)(()=>{t&&((async()=>{try{const e=await Object(n.c)("requests/requests"),t=Array.isArray(e.results)?e.results:[],a=(null===s||void 0===s?void 0:s.requests)||[],r=[...a,...t.filter(e=>!a.some(t=>t.id===e.id))];b(r)}catch(e){console.error("Error fetching requests:",e)}})(),m((null===s||void 0===s?void 0:s.name)||""),y((null===s||void 0===s?void 0:s.request_ids)||[]),h({}))},[t,s]),t?l.a.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},l.a.createElement("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4"},l.a.createElement("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},l.a.createElement(d.ModalHeader,null,"Edit Batch"),l.a.createElement("button",{onClick:a},"\u2716\ufe0f")),l.a.createElement("div",{className:"p-6"},l.a.createElement(d.Label,{className:"block mb-4"},l.a.createElement("span",null,"Batch Name *"),l.a.createElement(d.Input,{className:"mt-1",name:"name",value:o,onChange:e=>m(e.target.value),placeholder:"Enter batch name"}),g.name&&l.a.createElement("p",{className:"text-xs text-red-600 mt-1"},g.name)),l.a.createElement("div",{className:"mb-4 overflow-x-auto border rounded-md"},l.a.createElement("label",{className:"block text-sm font-medium mb-2 dark:text-white"},"Select Requests *"),l.a.createElement("table",{className:"min-w-full text-sm text-left table-auto"},l.a.createElement("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"},l.a.createElement("tr",null,l.a.createElement("th",{className:"px-3 py-2"},l.a.createElement("input",{type:"checkbox",checked:p.length>0&&p.length===u.length,onChange:e=>y(e.target.checked?u.map(e=>e.id):[])})),l.a.createElement("th",{className:"px-3 py-2"},"ID"),l.a.createElement("th",{className:"px-3 py-2"},"Type"),l.a.createElement("th",{className:"px-3 py-2"},"Status"))),l.a.createElement("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600"},u.map(e=>{var t;return l.a.createElement("tr",{key:e.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white"},l.a.createElement("td",{className:"px-3 py-2"},l.a.createElement("input",{type:"checkbox",checked:p.includes(e.id),onChange:()=>{return t=e.id,void y(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}})),l.a.createElement("td",{className:"px-3 py-2"},e.id),l.a.createElement("td",{className:"px-3 py-2"},e.type||"\u2014"),l.a.createElement("td",{className:"px-3 py-2"},"change_city_request"===e.type&&e.city_name,"change_zone_request"===e.type&&e.zone_name,"pass_request"===e.type&&"".concat(null===(t=e.toggle)||void 0===t?void 0:t.toUpperCase()," - ").concat(e.pass_date)))}))),g.requests&&l.a.createElement("p",{className:"text-xs text-red-600 mt-2"},g.requests)),g.submit&&l.a.createElement("p",{className:"text-sm text-red-600 mt-2"},g.submit)),l.a.createElement("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end"},l.a.createElement(d.Button,{onClick:async()=>{if((()=>{const e={};return o.trim()||(e.name="Name is required"),0===p.length&&(e.requests="Select at least one request"),h(e),0===Object.keys(e).length})())try{x(!0),await Object(n.d)("requests/batch/".concat(s.id,"/edit/"),{name:o,request_ids:p}),i.a.success("Batch updated successfully"),"function"===typeof c&&c(),a()}catch(e){console.error("Submit error:",e),h({submit:"Failed to update batch. Please try again."})}finally{x(!1)}},disabled:E,className:E?"opacity-50 cursor-not-allowed":""},E?"Updating...":"Update Batch")))):null};a(41),a(48);t.default=function(){Object(c.g)();const[e,t]=Object(r.useState)([]),[a,m]=Object(r.useState)(!0),[p,y]=Object(r.useState)(null),[g,h]=Object(r.useState)(!1),[E,x]=Object(r.useState)(!1),[f,k]=Object(r.useState)(null),[N,v]=Object(r.useState)(0),[w,j]=Object(r.useState)(null),[O,C]=Object(r.useState)(!1),q=e=>{let{batchId:t}=e;return l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:e=>{e.stopPropagation(),S(t,"todo")},className:"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 p-1 rounded",title:"Delete (TODO)"},l.a.createElement(o.b,{className:"h-5 w-5"})),l.a.createElement("button",{onClick:e=>{e.stopPropagation(),S(t,"completed")},className:"text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 p-1 rounded",title:"Mark Completed"},"\u2705"),l.a.createElement("button",{onClick:e=>{e.stopPropagation(),S(t,"duplicate")},className:"text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/30 p-1 rounded",title:"Mark Duplicate"},"\ud83d\udcc4"))};Object(r.useEffect)(()=>{(async()=>{try{m(!0);const e=await Object(n.c)("/requests/batch/");t(e.results)}catch(e){console.error("Error fetching batch data:",e),y("Failed to load batch data")}finally{m(!1)}})()},[N]);const S=async(e,a)=>{try{const r="todo"===a?"Are you sure you want to delete this batch and reset requests to TODO?":'Are you sure you want to mark this batch as "'.concat(a,'" and keep it?');if(!window.confirm(r))return;await Object(n.a)("requests/batches/".concat(e,"/delete/?status=").concat(a)),t(t=>"todo"===a?t.filter(t=>t.id!==e):t),i.a.success("todo"===a?"Batch deleted and requests set to TODO":'Batch marked as "'.concat(a,'" successfully'))}catch(r){console.error("Batch update failed:",r),i.a.error("Failed to update batch. Please try again.")}};return l.a.createElement("div",{className:"relative w-full px-4 py-6"},l.a.createElement("div",{className:"relative z-10"},l.a.createElement("div",{className:"flex items-center justify-between mb-6"},l.a.createElement(s.a,null,"Batchs ")),a?l.a.createElement("div",{className:"flex justify-center my-8"},l.a.createElement("p",{className:"text-gray-700 dark:text-gray-300"},"Loading data...")):p?l.a.createElement("div",{className:"text-center py-8"},l.a.createElement("p",{className:"text-red-600 dark:text-red-400"},p)):l.a.createElement(l.a.Fragment,null,l.a.createElement(d.TableContainer,{className:"hidden md:block mb-8",style:{opacity:.97}},l.a.createElement(d.Table,null,l.a.createElement(d.TableHeader,null,l.a.createElement("tr",null,l.a.createElement(d.TableCell,null,"S.No"),l.a.createElement(d.TableCell,null,"Name"),l.a.createElement(d.TableCell,null,"Request IDs"),l.a.createElement(d.TableCell,null,"Actions"))),l.a.createElement(d.TableBody,null,e.map((e,t)=>l.a.createElement(d.TableRow,{key:e.id},l.a.createElement(d.TableCell,null,l.a.createElement("span",{className:"text-sm font-semibold"},t+1)),l.a.createElement(d.TableCell,null,l.a.createElement("span",{className:"text-sm font-semibold"},e.name)),l.a.createElement(d.TableCell,null,l.a.createElement("span",{className:"text-sm"},e.request_ids)),l.a.createElement(d.TableCell,null,l.a.createElement("div",{className:"flex items-center space-x-4"},l.a.createElement(d.Button,{layout:"link",size:"icon","aria-label":"Mark as Todo",onClick:()=>S(e.id,"todo"),className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full hover:bg-red-200 dark:bg-red-900 dark:text-red-300 dark:hover:bg-red-800"},l.a.createElement(o.b,{className:"w-5 h-5","aria-hidden":"true"}),"TODO"),l.a.createElement(d.Button,{layout:"link",size:"icon","aria-label":"Mark as Completed",onClick:()=>S(e.id,"completed"),className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded-full hover:bg-green-200 dark:bg-green-900 dark:text-green-300 dark:hover:bg-green-800"},"COMPLETED"),l.a.createElement(d.Button,{layout:"link",size:"icon","aria-label":"Mark as Duplicate",onClick:()=>S(e.id,"duplicate"),className:"px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded-full hover:bg-yellow-200 dark:bg-yellow-500 dark:text-yellow-200 dark:hover:bg-yellow-700"},"DUPLICATE")))))))),l.a.createElement("div",{className:"md:hidden space-y-3"},0===e.length?l.a.createElement("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400"},"No batches found"):e.map((e,t)=>l.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 hover:border-purple-200 dark:hover:border-purple-700 transition-colors",onClick:()=>(j(e),void C(!0))},l.a.createElement("div",{className:"flex items-center p-3"},l.a.createElement("div",{className:"h-12 w-12 mr-3 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 flex items-center justify-center font-medium"},t+1),l.a.createElement("div",{className:"flex-1 min-w-0"},l.a.createElement("div",{className:"flex items-center justify-between"},l.a.createElement("p",{className:"font-medium dark:text-white truncate"},e.full_name)),l.a.createElement("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mt-0.5"},l.a.createElement("span",{className:"truncate"},"Name: ",e.name)),l.a.createElement("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mt-0.5"},l.a.createElement("span",{className:"truncate"},"Request IDs: ",e.request_ids))),l.a.createElement("div",{className:"flex justify-center"},l.a.createElement(q,{batchId:e.id})))))))),l.a.createElement(u,{isOpen:g,onClose:()=>{h(!1)},onBatchCreated:()=>{v(e=>e+1)}}),f&&l.a.createElement(b,{isOpen:E,onClose:()=>{x(!1),k(null)},onBatchUpdated:()=>{v(e=>e+1),i.a.success("Batch updated successfully")},batchData:f}))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return d})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return i})),a.d(t,"g",(function(){return u}));var r=a(109);let l="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),l="https://rms-v2.duckdns.org/api";const c=r.a.create({baseURL:l,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const n=async(e,t)=>c.get(e,{params:t}).then(e=>e.data),s=async(e,t)=>c.post(e,t).then(e=>e.data),d=async(e,t)=>c.put(e,t).then(e=>e.data),o=async(e,t)=>c.patch(e,t).then(e=>e.data),m=async e=>c.delete(e).then(e=>e.data),i=async(e,t)=>{try{const a=await c.get(e,{responseType:"blob"}),r=new Blob([a.data],{type:"application/pdf"}),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}catch(a){throw console.error("Download failed:",a),a}},u=async(e,t)=>{try{return(await c.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}},45:function(e,t,a){"use strict";var r=a(0),l=a.n(r);t.a=function(e){let{children:t}=e;return l.a.createElement("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"},t)}}}]);
//# sourceMappingURL=15.38446edb.chunk.js.map