(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[31],{120:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(40),s=t(17),c=t(18),m=t.n(c),o=(t(41),t(44)),i=t(11),u=t(62);var d=e=>{let{isOpen:a,onClose:t,onUserCreated:c}=e;const[o,d]=Object(n.useState)({}),p=Object(n.useRef)(),b={control:e=>Object(i.a)(Object(i.a)({},e),{},{minHeight:"58px",borderRadius:"0.375rem",borderColor:"#d1d5db",boxShadow:"none"}),multiValue:e=>Object(i.a)(Object(i.a)({},e),{},{backgroundColor:"#e5e7eb"}),multiValueLabel:e=>Object(i.a)(Object(i.a)({},e),{},{color:"#1A1C23"}),menu:e=>Object(i.a)(Object(i.a)({},e),{},{zIndex:9999}),menuList:e=>Object(i.a)(Object(i.a)({},e),{},{maxHeight:"200px",overflowY:"auto"}),menuPortal:e=>Object(i.a)(Object(i.a)({},e),{},{zIndex:9999})},[E,y]=Object(n.useState)({first_name:"",last_name:"",username:"",email:"",password:"",precedence_level:"",custom_permissions:[]}),[g,h]=Object(n.useState)([]),[f,v]=Object(n.useState)(!1),[w,O]=Object(n.useState)(null);l.a.useEffect(()=>{a||(y({first_name:"",last_name:"",username:"",email:"",password:"",precedence_level:"",custom_permissions:[]}),d({}));(async()=>{try{const e=await Object(r.c)("/users/seed-permissions/");h(e||[])}catch(e){console.error("Error fetching permissions data:",e),O("Failed to load permissions data")}})()},[a]);const j=g.map(e=>({value:e.code,label:e.description||e.code})),x=e=>{const{name:a,value:t}=e.target;y(e=>Object(i.a)(Object(i.a)({},e),{},{[a]:t}))},C=async e=>{e.preventDefault(),v(!0),O(null);const a=parseInt(E.precedence_level,10);if(isNaN(a)||a<1||a>5)return O("Precedence level must be between 1 and 5."),void v(!1);try{const e=Object(i.a)({},E);await Object(r.e)("/users/create/",e),m.a.success("User created successfully!"),c(),t()}catch(w){console.error("Error creating request:",w),w.response&&w.response.data?(d(Object(i.a)(Object(i.a)(Object(i.a)({},w.response.data.username),o),{},{submit:w.response.data.username})),console.log(w.response.data.username)):d({submit:"Failed to create request. Please try again."})}finally{v(!1)}};return l.a.createElement(s.Modal,{isOpen:a,onClose:t,style:{maxWidth:"500px"}},l.a.createElement(s.ModalHeader,null,"Create New User"),l.a.createElement(s.ModalBody,null,w&&l.a.createElement("div",{className:"mb-4 text-sm text-red-600"},w),l.a.createElement("form",{onSubmit:C,className:"space-y-4"},l.a.createElement("div",{className:"grid grid-cols-2 gap-4"},l.a.createElement(s.Label,null,l.a.createElement("span",null,"First Name"),l.a.createElement(s.Input,{name:"first_name",value:E.first_name,onChange:x,required:!0})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Last Name"),l.a.createElement(s.Input,{name:"last_name",value:E.last_name,onChange:x,required:!0}))),l.a.createElement("div",{className:"grid grid-cols-2 gap-4"},l.a.createElement(s.Label,null,l.a.createElement("span",null,"ITS"),l.a.createElement(s.Input,{name:"username",value:E.username,onChange:x,required:!0})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Email"),l.a.createElement(s.Input,{type:"email",name:"email",value:E.email,onChange:x,required:!0}))),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Password"),l.a.createElement(s.Input,{type:"password",name:"password",value:E.password,onChange:x,required:!0})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Precedence Level (1-5)"),l.a.createElement(s.Input,{type:"number",name:"precedence_level",value:E.precedence_level,onChange:x,required:!0,min:"1",max:"5"})),l.a.createElement(s.Label,{className:"block text-sm font-medium text-gray-700 mb-1"},"Custom Permissions",l.a.createElement(u.a,{name:"custom_permissions",ref:p,isMulti:!0,options:j,value:j.filter(e=>E.custom_permissions.includes(e.value)),onChange:e=>{const a=e?e.map(e=>e.value):[];y(e=>Object(i.a)(Object(i.a)({},e),{},{custom_permissions:a}))},placeholder:"Select permissions...",menuPortalTarget:document.body,styles:b})),o.fetch&&l.a.createElement("div",{className:"mb-4"},l.a.createElement("p",{className:"text-sm text-red-600"},o.fetch)),o.submit&&l.a.createElement("div",{className:"mb-4"},l.a.createElement("p",{className:"text-sm text-red-600"},o.submit)))),l.a.createElement(s.ModalFooter,null,l.a.createElement(s.Button,{layout:"outline",onClick:t},"Cancel"),l.a.createElement(s.Button,{onClick:C,disabled:f},f?"Creating...":"Create")))};var p=e=>{let{isOpen:a,onClose:t,onUserUpdated:c,userData:o}=e;const[d,p]=Object(n.useState)({}),b=Object(n.useRef)(),E={control:e=>Object(i.a)(Object(i.a)({},e),{},{minHeight:"58px",borderRadius:"0.375rem",borderColor:"#d1d5db",boxShadow:"none"}),multiValue:e=>Object(i.a)(Object(i.a)({},e),{},{backgroundColor:"#e5e7eb"}),multiValueLabel:e=>Object(i.a)(Object(i.a)({},e),{},{color:"#1A1C23"}),menu:e=>Object(i.a)(Object(i.a)({},e),{},{zIndex:9999}),menuList:e=>Object(i.a)(Object(i.a)({},e),{},{maxHeight:"200px",overflowY:"auto"}),menuPortal:e=>Object(i.a)(Object(i.a)({},e),{},{zIndex:9999})},[y,g]=Object(n.useState)({first_name:"",last_name:"",username:"",email:"",password:"",precedence_level:"",custom_permissions:[]}),[h,f]=Object(n.useState)([]),[v,w]=Object(n.useState)(!1),[O,j]=Object(n.useState)(null);Object(n.useEffect)(()=>{if(!a)return void x();o&&g({first_name:o.first_name||"",last_name:o.last_name||"",username:o.username||"",email:o.email||"",password:"",precedence_level:o.precedence_level||"",custom_permissions:Array.isArray(o.custom_permissions)?o.custom_permissions:[]});(async()=>{try{const e=await Object(r.c)("/users/seed-permissions/");f(e||[])}catch(e){console.error("Error fetching permissions data:",e),j("Failed to load permissions data")}})()},[a,o]);const x=()=>{g({first_name:"",last_name:"",username:"",email:"",password:"",precedence_level:"",custom_permissions:[]}),p({}),j(null)},C=e=>{const{name:a,value:t}=e.target;g(e=>Object(i.a)(Object(i.a)({},e),{},{[a]:t}))},_=h.map(e=>({value:e.code,label:e.description||e.code})),N=async e=>{e.preventDefault(),w(!0),j(null);const a=parseInt(y.precedence_level,10);if(isNaN(a)||a<1||a>5)return j("Precedence level must be between 1 and 5."),void w(!1);try{const e={first_name:y.first_name,last_name:y.last_name,username:y.username,email:y.email,precedence_level:a,custom_permissions:y.custom_permissions};""!==y.password.trim()&&(e.password=y.password),await Object(r.f)("/users/update/".concat(o.id,"/"),e),m.a.success("User updated successfully!"),c(),t()}catch(n){console.error(n),j("Failed to update user.")}finally{w(!1)}};return l.a.createElement(s.Modal,{isOpen:a,onClose:t,style:{maxWidth:"500px"}},l.a.createElement(s.ModalHeader,null,"Edit User ",y.username),l.a.createElement(s.ModalBody,null,O&&l.a.createElement("div",{className:"mb-4 text-sm text-red-600"},O),l.a.createElement("form",{onSubmit:N,className:"space-y-4"},l.a.createElement("div",{className:"grid grid-cols-2 gap-4"},l.a.createElement(s.Label,null,l.a.createElement("span",null,"First Name"),l.a.createElement(s.Input,{name:"first_name",value:y.first_name,onChange:C,required:!0})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Last Name"),l.a.createElement(s.Input,{name:"last_name",value:y.last_name,onChange:C,required:!0}))),l.a.createElement("div",{className:"grid grid-cols-2 gap-4"},l.a.createElement(s.Label,null,l.a.createElement("span",null,"ITS"),l.a.createElement(s.Input,{name:"username",value:y.username,onChange:C,required:!0})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Email"),l.a.createElement(s.Input,{type:"email",name:"email",value:y.email,onChange:C,required:!0}))),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Password (leave empty to keep unchanged)"),l.a.createElement(s.Input,{type:"password",name:"password",value:y.password,onChange:C})),l.a.createElement(s.Label,null,l.a.createElement("span",null,"Precedence Level (1-5)"),l.a.createElement(s.Input,{type:"number",min:"1",max:"5",name:"precedence_level",value:y.precedence_level,onChange:C,required:!0})),l.a.createElement(s.Label,{className:"block text-sm font-medium text-gray-700 mb-1"},"Custom Permissions",l.a.createElement(u.a,{name:"custom_permissions",ref:b,isMulti:!0,options:_,value:_.filter(e=>y.custom_permissions.includes(e.value)),onChange:e=>{const a=e?e.map(e=>e.value):[];g(e=>Object(i.a)(Object(i.a)({},e),{},{custom_permissions:a}))},placeholder:"Select permissions...",menuPortalTarget:document.body,styles:E})))),l.a.createElement(s.ModalFooter,null,l.a.createElement(s.Button,{layout:"outline",onClick:t},"Cancel"),l.a.createElement(s.Button,{onClick:N,disabled:v},v?"Updating...":"Update")))};a.default=()=>{const[e,a]=Object(n.useState)([]),[t,c]=Object(n.useState)([]),[i,u]=Object(n.useState)(!0),[b,E]=Object(n.useState)(null),[y,g]=Object(n.useState)(0),[h,f]=Object(n.useState)(!1),[v,w]=Object(n.useState)(null),[O,j]=Object(n.useState)(!1);Object(n.useEffect)(()=>{x()},[y]);const x=async()=>{try{const[e,t]=await Promise.all([Object(r.c)("/users/read/")]);a(Array.isArray(e)?e:[]),c(Array.isArray(t)?t:[])}catch(e){console.error("Error fetching users or zones:",e),E("Failed to fetch data.")}finally{u(!1)}},C=async e=>{try{window.confirm("Are you sure you want to delete this User?")&&(await Object(r.a)("/users/delete/".concat(e,"/")),a(a=>a.filter(a=>a.id!==e)),m.a.success("User deleted successfully"))}catch(b){console.error("Error deleting User:",b),m.a.error("Failed to delete User. Please try again.")}},_=e=>{w(e),f(!0)};return l.a.createElement("div",{className:"relative w-full px-4 py-6"},l.a.createElement("div",{className:"relative z-10"},l.a.createElement("div",{className:"flex justify-between items-center mb-6"},l.a.createElement("h2",{className:"text-2xl font-semibold  dark:text-white"},"User Management"),l.a.createElement("button",{onClick:()=>{j(!0)},className:"flex items-center bg-purple-600 text-white rounded-lg",style:{fontSize:window.innerWidth<768?"0.875rem":"1rem",padding:window.innerWidth<768?"0.5rem 1rem":"0.75rem 1rem"}},l.a.createElement(o.e,{className:"mr-1 ".concat(window.innerWidth<768?"w-3 h-3":"w-4 h-4")}),"Create User")),i?l.a.createElement("p",{className:"text-gray-600"},"Loading users..."):b?l.a.createElement("p",{className:"text-red-500"},b):l.a.createElement(l.a.Fragment,null,l.a.createElement(s.TableContainer,{className:"hidden md:block mb-8"},l.a.createElement(s.Table,null,l.a.createElement(s.TableHeader,null,l.a.createElement("tr",null,l.a.createElement(s.TableCell,null,"Name"),l.a.createElement(s.TableCell,null,"ITS"),l.a.createElement(s.TableCell,null,"Actions"))),l.a.createElement(s.TableBody,null,Array.isArray(e)&&0===e.length?l.a.createElement(s.TableRow,null,l.a.createElement(s.TableCell,{colSpan:"4",className:"text-center text-gray-500"},"No users found.")):e.map(e=>l.a.createElement(s.TableRow,{key:e.id},l.a.createElement(s.TableCell,null,e.first_name," ",e.last_name),l.a.createElement(s.TableCell,null,e.username),l.a.createElement(s.TableCell,null,l.a.createElement("div",{className:"flex items-center space-x-4"},l.a.createElement(s.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>_(e)},l.a.createElement(o.d,{className:"w-5 h-5"})),l.a.createElement(s.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>C(e.id)},l.a.createElement(o.b,{className:"w-5 h-5"}))))))))),l.a.createElement("div",{className:"md:hidden space-y-3"},0===e.length?l.a.createElement("div",{className:"text-center py-8"},l.a.createElement("p",{className:"text-gray-700 dark:text-gray-300"},"No city items found")):e.map((e,a)=>l.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700 p-4"},l.a.createElement("div",{className:"flex justify-between items-start"},l.a.createElement("div",null,l.a.createElement("div",{className:"flex items-center gap-2 mb-2"},l.a.createElement("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 text-xs font-medium px-2 py-1 rounded"},"#",e.id)),l.a.createElement("h3",{className:"font-medium text-lg dark:text-white"},e.first_name," ",e.last_name),l.a.createElement("p",{className:"font-medium dark:text-white truncate"},e.username)),l.a.createElement("div",{className:"flex space-x-2"},l.a.createElement("button",{onClick:()=>_(e),className:"text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/30 p-1 rounded"},l.a.createElement(o.d,{className:"h-5 w-5"})),l.a.createElement("button",{onClick:()=>C(e.id),className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30 p-1 rounded"},l.a.createElement(o.b,{className:"h-5 w-5"})))))))),l.a.createElement(d,{isOpen:O,onClose:()=>{j(!1)},onUserCreated:()=>{j(!1),g(e=>e+1)}}),l.a.createElement(p,{isOpen:h,onClose:()=>f(!1),onUserUpdated:()=>g(e=>e+1),userData:v})))}},40:function(e,a,t){"use strict";t.d(a,"c",(function(){return s})),t.d(a,"e",(function(){return c})),t.d(a,"f",(function(){return m})),t.d(a,"d",(function(){return o})),t.d(a,"a",(function(){return i})),t.d(a,"b",(function(){return u})),t.d(a,"g",(function(){return d}));var n=t(109);let l="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),l="http://35.172.211.35/api";const r=n.a.create({baseURL:l,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const a=localStorage.getItem("accessToken");return a&&(e.headers.Authorization="Bearer ".concat(a)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const s=async(e,a)=>r.get(e,{params:a}).then(e=>e.data),c=async(e,a)=>r.post(e,a).then(e=>e.data),m=async(e,a)=>r.put(e,a).then(e=>e.data),o=async(e,a)=>r.patch(e,a).then(e=>e.data),i=async e=>r.delete(e).then(e=>e.data),u=async(e,a)=>{try{const t=await r.get(e,{responseType:"blob"}),n=new Blob([t.data],{type:"application/pdf"}),l=window.URL.createObjectURL(n),s=document.createElement("a");s.href=l,s.setAttribute("download",a),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(l)}catch(t){throw console.error("Download failed:",t),t}},d=async(e,a)=>{try{return(await r.post(e,a,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){throw console.error("File upload failed:",t),t}}}}]);
//# sourceMappingURL=31.88733b37.chunk.js.map