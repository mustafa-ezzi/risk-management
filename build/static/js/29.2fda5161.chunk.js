(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[29],{122:function(e,t,a){"use strict";a.r(t);var n=a(11),r=a(0),l=a.n(r),c=a(1),s=a(40),o=a(57),m=a(44),i=a(18),d=a.n(i),u=a(17);var p=e=>{let{isOpen:t,onClose:a,miqaatId:c,onSuccess:o,existingMenuItems:m}=e;const[i,p]=Object(r.useState)({miqaat:c||"",menu:"",description:""}),[b,E]=Object(r.useState)({menus:[]}),[g,y]=Object(r.useState)(!1),[f,v]=Object(r.useState)(null);Object(r.useEffect)(()=>{t&&(async()=>{try{const e=(await Object(s.c)("/menu/list/")).filter(e=>!m.some(t=>t.menu_id===e.id));E({menus:e})}catch(e){console.error("Error fetching dropdown options:",e),v("Failed to load dropdown options")}})()},[t,m]);const h=e=>{const{name:t,value:a}=e.target;p(e=>Object(n.a)(Object(n.a)({},e),{},{[t]:a}))},x=async e=>{e.preventDefault(),y(!0),v(null);try{if(!i.miqaat||!i.menu)return v("Please select both Miqaat and Menu items"),void y(!1);const e={miqaat:parseInt(i.miqaat),menu:parseInt(i.menu),description:i.description||""},t=await Object(s.e)("/miqaat-menu/",e);o(t),p({miqaat:c||"",menu:""}),a(),d.a.success("Menu item added successfully")}catch(r){var t,n;console.error("Error creating miqaat menu record:",r);const e=(null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to create menu record";v(e),d.a.error(e)}finally{y(!1)}};return l.a.createElement(u.Modal,{isOpen:t,onClose:a},l.a.createElement(u.ModalHeader,null,"Add Menu Item"),l.a.createElement(u.ModalBody,null,f&&l.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},l.a.createElement("span",{className:"block sm:inline"},f)),l.a.createElement("form",{onSubmit:x},l.a.createElement("div",{className:"grid grid-cols-1 gap-4"},l.a.createElement(u.Label,{className:"block text-sm"},l.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Menu Item"),l.a.createElement(u.Select,{name:"menu",value:i.menu,onChange:h,className:"mt-1",required:!0},l.a.createElement("option",{value:""},"Select Menu Item"),0===b.menus.length?l.a.createElement("option",{disabled:!0},"No available menu items"):b.menus.map(e=>l.a.createElement("option",{key:e.id,value:e.id},e.name||"Menu #".concat(e.id))))),l.a.createElement(u.Label,null,l.a.createElement("span",null,"Description"),l.a.createElement(u.Textarea,{className:"mt-1",name:"description",value:i.description,placeholder:"Enter Description",rows:"3",onChange:h}))," "))),l.a.createElement(u.ModalFooter,null,l.a.createElement("div",{className:"hidden sm:block"},l.a.createElement(u.Button,{onClick:x,disabled:g||0===b.menus.length},g?"Saving...":"Save")),l.a.createElement("div",{className:"w-full sm:hidden"},l.a.createElement(u.Button,{block:!0,size:"large",onClick:x,disabled:g||0===b.menus.length},g?"Saving...":"Save"))))},b=a(41),E=a.n(b);t.default=function(){var e,t;const{id:a}=Object(c.i)(),i=Object(c.g)(),[b,g]=Object(r.useState)(null),[y,f]=Object(r.useState)(!0),[v,h]=Object(r.useState)(null),[x,w]=Object(r.useState)(null),[N,k]=Object(r.useState)(!1),[j,C]=Object(r.useState)(null);Object(r.useEffect)(()=>{O()},[a]);const O=async()=>{f(!0),h(null);try{const e=await Object(s.c)("/miqaat-menu/".concat(a,"/"));g(e)}catch(e){console.error("Error fetching menu data:",e),h("Failed to load menu data. Please try again.")}finally{f(!1)}},S=async e=>{try{window.confirm("Are you sure you want to delete this menu item?")&&(await Object(s.a)("/miqaat-menu/".concat(e,"/")),g(t=>Object(n.a)(Object(n.a)({},t),{},{miqaat_menu:t.miqaat_menu.filter(t=>t.id!==e)})),d.a.success("Menu item deleted successfully"))}catch(v){console.error("Error deleting menu item:",v),d.a.error("Failed to delete menu item. Please try again.")}},q=e=>{C(j===e?null:e)},T=(null===b||void 0===b||null===(e=b.miqaat_menu)||void 0===e?void 0:e.map(e=>({menu_id:e.menu_id,menu_name:e.menu_name})))||[],M=Object(r.useRef)(null);return l.a.createElement("div",{className:"relative w-full px-4 py-6"},l.a.createElement("img",{src:E.a,alt:"Watermark",className:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",position:"absolute",transform:"translate(-50%, -50%)",width:"70vw",maxWidth:"400px",height:"auto",opacity:.05,zIndex:0}}),l.a.createElement("div",{className:"relative z-10"},l.a.createElement("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center mb-6 gap-4"},l.a.createElement("div",{className:"flex items-center"},l.a.createElement("button",{onClick:()=>{i.goBack()},className:"mr-4"},l.a.createElement(m.a,{className:"w-5 h-5 dark:text-white"})),l.a.createElement("h1",{style:{fontSize:window.innerWidth<768?"1.25rem":"1.5rem"},className:"font-semibold dark:text-white"},"Miqaat Menu",x&&" - ".concat(x.miqaat_name))),l.a.createElement("div",{className:"flex gap-4"},l.a.createElement("button",{className:"bg-purple-600 hover:bg-purple-700 text-white text-sm sm:text-base px-4 py-2 rounded flex items-center justify-center w-full sm:w-auto",onClick:()=>{k(!0)}},l.a.createElement(o.d,{className:"mr-2"})," Create"),l.a.createElement("button",{className:"bg-green-600 hover:bg-green-700 text-white text-sm sm:text-base px-4 py-2 rounded flex items-center justify-center w-full sm:w-[10px]",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()}},l.a.createElement(o.g,{className:"mr-2"})," Upload CSV"),l.a.createElement("input",{type:"file",accept:".csv",ref:M,onChange:async()=>{var e,t;const a=null===(e=M.current)||void 0===e||null===(t=e.files)||void 0===t?void 0:t[0];if(!a)return;const n=new FormData;n.append("file",a);try{var r,l;const e=await Object(s.g)("/upload-menu",n);if(e.message&&d.a.success(e.data.message),O(),null===(r=e.data)||void 0===r||null===(l=r.errors)||void 0===l?void 0:l.length){const t=e.data.errors.map(e=>"Row ".concat(e.row,": ").concat(e.error)).join("\n");d.a.error("\u26a0\ufe0f Errors:\n".concat(t),{duration:8e3}),console.warn("CSV upload issues:",e.data.errors)}}catch(v){var c,o;if(null===(c=v.response)||void 0===c||null===(o=c.data)||void 0===o?void 0:o.errors){const t=v.response.data.errors.map(e=>"Row ".concat(e.row,": ").concat(e.error)).join("\n");d.a.error("\u26a0\ufe0f Upload failed:\n".concat(t),{duration:8e3})}else d.a.error("\u274c Upload failed: "+(v.message||"Unknown error"))}finally{M.current&&(M.current.value=null)}},className:"hidden"}))),y?l.a.createElement("div",{className:"flex justify-center my-8"},l.a.createElement("p",{className:"text-gray-700 dark:text-300"},"Loading data...")):v?l.a.createElement("div",{className:"text-center py-8"},l.a.createElement("p",{className:"text-red-600"},v),l.a.createElement("button",{onClick:O,className:"mt-4 bg-purple-600 text-white px-4 py-2 rounded"},"Retry")):l.a.createElement(l.a.Fragment,null,l.a.createElement(u.TableContainer,{className:"hidden md:block mb-8"},l.a.createElement(u.Table,null,l.a.createElement(u.TableHeader,null,l.a.createElement("tr",null,l.a.createElement(u.TableCell,null,"ID"),l.a.createElement(u.TableCell,null,"MENU NAME"),l.a.createElement(u.TableCell,null,"DESCRIPTION"),l.a.createElement(u.TableCell,{className:"text-right"},"ACTIONS"))),l.a.createElement(u.TableBody,null,null===b||void 0===b||null===(t=b.miqaat_menu)||void 0===t?void 0:t.map((e,t)=>l.a.createElement(u.TableRow,{key:e.id},l.a.createElement(u.TableCell,null,l.a.createElement("span",{className:"text-sm"},t+1)),l.a.createElement(u.TableCell,null,l.a.createElement("span",{className:"text-sm font-medium"},e.menu_name)),l.a.createElement(u.TableCell,null,l.a.createElement("span",{className:"text-sm"},e.description)),l.a.createElement(u.TableCell,{className:"text-right"},l.a.createElement("button",{onClick:()=>S(e.id),className:"text-gray-600 hover:text-red-600"},l.a.createElement(m.b,{className:"h-4 w-4 inline-block"})))))))),l.a.createElement("div",{className:"md:hidden space-y-3"},(null===b||void 0===b?void 0:b.miqaat_menu)&&0!==b.miqaat_menu.length?b.miqaat_menu.map((e,t)=>l.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700"},l.a.createElement("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>q(e.id)},l.a.createElement("div",{className:"flex items-center space-x-3"},l.a.createElement("div",{className:"bg-gray-100 dark:bg-gray-700 h-8 w-8 rounded-full flex items-center justify-center text-gray-700 dark:text-gray-300 font-medium"},t+1),l.a.createElement("div",{className:"font-medium text-gray-800 dark:text-gray-200"},e.menu_name)),l.a.createElement("button",{onClick:t=>{t.stopPropagation(),q(e.id)},className:"text-gray-600 dark:text-gray-400"},l.a.createElement(m.c,{className:"h-4 w-4 transition-transform ".concat(j===e.id?"rotate-180":"")}))),j===e.id&&l.a.createElement("div",{className:"px-4 pb-4 pt-0 border-t dark:border-gray-700"},l.a.createElement("div",{className:"mt-2"},l.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Description:"),l.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.menu_description)),l.a.createElement("div",{className:"mt-4 flex justify-end"},l.a.createElement("button",{onClick:()=>S(e.id),className:"text-white px-4 py-1 rounded-md bg-red-600 hover:bg-red-700 flex items-center"},l.a.createElement(m.b,{className:"h-4 w-4 mr-1"}),"Delete"))))):l.a.createElement("div",{className:"text-center py-8"},l.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"No menu items found")))),N&&l.a.createElement(p,{isOpen:N,onClose:()=>{k(!1)},miqaatId:a,onSuccess:()=>{O()},existingMenuItems:T})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return o})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return d})),a.d(t,"g",(function(){return u}));var n=a(109);let r="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),r="https://rms-v2.duckdns.org/api";const l=n.a.create({baseURL:r,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const c=async(e,t)=>l.get(e,{params:t}).then(e=>e.data),s=async(e,t)=>l.post(e,t).then(e=>e.data),o=async(e,t)=>l.put(e,t).then(e=>e.data),m=async(e,t)=>l.patch(e,t).then(e=>e.data),i=async e=>l.delete(e).then(e=>e.data),d=async(e,t)=>{try{const a=await l.get(e,{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),r=window.URL.createObjectURL(n),c=document.createElement("a");c.href=r,c.setAttribute("download",t),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(r)}catch(a){throw console.error("Download failed:",a),a}},u=async(e,t)=>{try{return(await l.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}}}]);
//# sourceMappingURL=29.2fda5161.chunk.js.map