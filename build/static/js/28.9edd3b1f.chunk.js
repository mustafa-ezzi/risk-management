(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[28],{114:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(1),l=a(40),s=a(17),o=a(44),m=a(11),i=a(18),d=a.n(i);var u=e=>{let{isOpen:t,onClose:a,miqaatId:r,onSuccess:o}=e;const[i,u]=Object(n.useState)({miqaat:r,zone:"",member:"",counter:"",checkin_time:"",checkout_time:""}),[b,p]=Object(n.useState)({zones:[],members:[],counters:[]}),[E,g]=Object(n.useState)(!1),[y,h]=Object(n.useState)(null);Object(n.useEffect)(()=>{t&&(async()=>{try{const[e,t,a]=await Promise.all([Object(l.c)("/zone/list/"),Object(l.c)("/member/list/"),Object(l.c)("/counter/list/")]);p({zones:e,members:t,counters:a})}catch(e){console.error("Error fetching dropdown options:",e),h("Failed to load dropdown options")}})()},[t]);const v=e=>{const{name:t,value:a}=e.target;u(e=>Object(m.a)(Object(m.a)({},e),{},{[t]:a}))},k=async e=>{e.preventDefault(),g(!0),h(null);try{const e=["zone","member","counter","checkin_time","checkout_time"].filter(e=>!i[e]);if(e.length>0)return h("Please fill in all required fields: ".concat(e.join(", "))),void g(!1);if(!((e,t)=>{if(!e||!t)return!0;(new Date).toISOString().split("T")[0];return!0})(i.checkin_time,i.checkout_time))return h("Invalid time range"),void g(!1);const t=Object(m.a)(Object(m.a)({},i),{},{miqaat:parseInt(r),zone:parseInt(i.zone),member:parseInt(i.member),counter:parseInt(i.counter)}),n=await Object(l.e)("/miqaat-attendance/",t);d.a.success("Attendance record created successfully"),o(n),a()}catch(c){var t,n;console.error("Error creating attendance record:",c),h((null===(t=c.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to create attendance record")}finally{g(!1)}};return c.a.createElement(s.Modal,{isOpen:t,onClose:a},c.a.createElement(s.ModalHeader,null,"Add Attendance Record"),c.a.createElement(s.ModalBody,null,y&&c.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},c.a.createElement("span",{className:"block sm:inline"},y)),c.a.createElement("form",{onSubmit:k},c.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Member *"),c.a.createElement(s.Select,{name:"member",value:i.member,onChange:v,className:"mt-1",required:!0},c.a.createElement("option",{value:""},"Select Member"),b.members.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.full_name||e.its||"Member #".concat(e.id))))),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Zone *"),c.a.createElement(s.Select,{name:"zone",value:i.zone,onChange:v,className:"mt-1",required:!0},c.a.createElement("option",{value:""},"Select Zone"),b.zones.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name)))),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Check-in Time *"),c.a.createElement(s.Input,{type:"time",name:"checkin_time",value:i.checkin_time,onChange:v,className:"mt-1",required:!0})),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Check-out Time *"),c.a.createElement(s.Input,{type:"time",name:"checkout_time",value:i.checkout_time,onChange:v,className:"mt-1",required:!0})),c.a.createElement(s.Label,{className:"block text-sm col-span-1 md:col-span-2"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Counter *"),c.a.createElement(s.Select,{name:"counter",value:i.counter,onChange:v,className:"mt-1",required:!0},c.a.createElement("option",{value:""},"Select Counter"),b.counters.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name||"Counter #".concat(e.id)))))))),c.a.createElement(s.ModalFooter,null,c.a.createElement("div",{className:"hidden sm:block"},c.a.createElement(s.Button,{onClick:k,disabled:E},E?"Saving...":"Save")),c.a.createElement("div",{className:"w-full sm:hidden"},c.a.createElement(s.Button,{block:!0,size:"large",onClick:k,disabled:E},E?"Saving...":"Save"))))},b=a(41),p=a.n(b);var E=e=>{let{isOpen:t,onClose:a,miqaatId:r,attendanceData:o,onSuccess:i}=e;const[u,b]=Object(n.useState)({miqaat:r,zone:"",member:"",counter:"",checkin_time:"",checkout_time:""}),[p,E]=Object(n.useState)({zones:[],members:[],counters:[]}),[g,y]=Object(n.useState)(!1),[h,v]=Object(n.useState)(null),[k,x]=Object(n.useState)(!1);Object(n.useEffect)(()=>{t&&(async()=>{x(!0);try{const[e,t,a]=await Promise.all([Object(l.c)("/zone/list/"),Object(l.c)("/member/list/"),Object(l.c)("/counter/list/")]);E({zones:Array.isArray(e)?e:e.results||[],members:Array.isArray(t)?t:t.results||[],counters:Array.isArray(a)?a:a.results||[]})}catch(e){console.error("Error fetching dropdown options:",e),v("Failed to load dropdown options")}finally{x(!1)}})()},[t]),Object(n.useEffect)(()=>{var e,t,a,n,c,l;o&&!k&&b({miqaat:r,zone:o.zone_id||(null!==(e=null===(t=o.zone)||void 0===t?void 0:t.id)&&void 0!==e?e:""),member:o.member_id||(null!==(a=null===(n=o.member)||void 0===n?void 0:n.id)&&void 0!==a?a:""),counter:o.counter_id||(null!==(c=null===(l=o.counter)||void 0===l?void 0:l.id)&&void 0!==c?c:""),checkin_time:o.checkin_time||"",checkout_time:o.checkout_time||""})},[o,r,k]);const f=e=>{const{name:t,value:a}=e.target;b(e=>Object(m.a)(Object(m.a)({},e),{},{[t]:a}))},N=async e=>{e.preventDefault(),y(!0),v(null);try{const e=["zone","member","counter","checkin_time","checkout_time"].filter(e=>!u[e]);if(e.length>0)throw new Error("Please fill in all required fields: ".concat(e.join(", ")));if(!p.zones.some(e=>e.id===parseInt(u.zone)))throw new Error("Please select a valid zone");if(!p.members.some(e=>e.id===parseInt(u.member)))throw new Error("Please select a valid member");if(!p.counters.some(e=>e.id===parseInt(u.counter)))throw new Error("Please select a valid counter");if(!((e,t)=>{if(!e||!t)return!0;const a=(new Date).toISOString().split("T")[0],n=new Date("".concat(a,"T").concat(e));return new Date("".concat(a,"T").concat(t))>=n})(u.checkin_time,u.checkout_time))throw new Error("Check-out time must be after check-in time");const t=Object(m.a)(Object(m.a)({},u),{},{miqaat:parseInt(r),zone:parseInt(u.zone),member:parseInt(u.member),counter:parseInt(u.counter)});await Object(l.d)("/miqaat-attendance/".concat(o.id,"/"),t),d.a.success("Attendance record updated successfully"),i(),a()}catch(t){console.error("Error updating attendance record:",t),v(t.message||"Failed to update attendance record")}finally{y(!1)}};return c.a.createElement(s.Modal,{isOpen:t,onClose:a},c.a.createElement(s.ModalHeader,null,"Edit Attendance Record"),c.a.createElement(s.ModalBody,null,h&&c.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},c.a.createElement("span",{className:"block sm:inline"},h)),k?c.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading options..."):c.a.createElement("form",{onSubmit:N},c.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Member *"),c.a.createElement(s.Select,{name:"member",value:u.member,onChange:f,className:"mt-1",required:!0,disabled:g},c.a.createElement("option",{value:""},"Select Member"),p.members.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.full_name||e.its||"Member #".concat(e.id))))),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Zone *"),c.a.createElement(s.Select,{name:"zone",value:u.zone,onChange:f,className:"mt-1",required:!0,disabled:g},c.a.createElement("option",{value:""},"Select Zone"),p.zones.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name)))),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Check-in Time *"),c.a.createElement(s.Input,{type:"time",name:"checkin_time",value:u.checkin_time,onChange:f,className:"mt-1",required:!0,disabled:g})),c.a.createElement(s.Label,{className:"block text-sm"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Check-out Time *"),c.a.createElement(s.Input,{type:"time",name:"checkout_time",value:u.checkout_time,onChange:f,className:"mt-1",required:!0,disabled:g})),c.a.createElement(s.Label,{className:"block text-sm col-span-1 md:col-span-2"},c.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Counter *"),c.a.createElement(s.Select,{name:"counter",value:u.counter,onChange:f,className:"mt-1",required:!0,disabled:g},c.a.createElement("option",{value:""},"Select Counter"),p.counters.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name||"Counter #".concat(e.id)))))))),c.a.createElement(s.ModalFooter,null,c.a.createElement("div",{className:"hidden sm:block"},c.a.createElement(s.Button,{onClick:N,disabled:g||k},g?"Updating...":"Update")),c.a.createElement("div",{className:"w-full sm:hidden"},c.a.createElement(s.Button,{block:!0,size:"large",onClick:N,disabled:g||k},g?"Updating...":"Update"))))};t.default=function(){const{id:e}=Object(r.i)(),t=Object(r.g)(),[a,m]=Object(n.useState)(null),[i,b]=Object(n.useState)(!0),[g,y]=Object(n.useState)(null),[h,v]=Object(n.useState)(null),[k,x]=Object(n.useState)(!1),[f,N]=Object(n.useState)(!1),[w,j]=Object(n.useState)(null),[O,C]=Object(n.useState)(null),[S,z]=Object(n.useState)(null),[_,q]=Object(n.useState)(null),[T,I]=Object(n.useState)([]),[A,L]=Object(n.useState)([]),M=async()=>{if(w)try{await Object(l.d)("/miqaat-attendance/".concat(w.id,"/"),{zone:S,sub_zone:_},"patch"),d.a.success("Attendance updated successfully"),j(null),D()}catch(g){console.error("Patch failed:",g),d.a.error("Failed to update attendance")}};Object(n.useEffect)(()=>{D(),F();(async()=>{const e=await Object(l.c)("/zone/list/");I(e)})(),(async()=>{const e=await Object(l.c)("/sub-zone/list/");L(e)})()},[e]);const D=async()=>{b(!0),y(null);try{const t=await Object(l.c)("/miqaat/member-attendance/?miqaat_id=".concat(e));m(t)}catch(t){console.error("Error fetching attendance data:",t),y("Failed to load attendance data. Please try again.")}finally{b(!1)}},F=async()=>{try{const t=await Object(l.c)("/miqaat/".concat(e,"/"));v(t)}catch(t){console.error("Error fetching miqaat details:",t)}};return c.a.createElement("div",{className:"relative w-full px-4 py-6"},c.a.createElement("img",{src:p.a,alt:"Watermark",className:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",position:"absolute",transform:"translate(-50%, -50%)",width:"70vw",maxWidth:"400px",height:"auto",opacity:.05,zIndex:0}}),c.a.createElement("div",{className:"relative z-10"},c.a.createElement("div",{className:"flex items-center justify-between mb-6"},c.a.createElement("div",{className:"flex items-center"},c.a.createElement("button",{onClick:()=>{t.goBack()},className:"mr-4"},c.a.createElement(o.a,{className:"w-5 h-5 dark:text-white"})),c.a.createElement("h1",{style:{fontSize:window.innerWidth<768?"1.25rem":"1.5rem"},className:"font-semibold dark:text-white"},"Attendance",h&&" - ".concat(h.miqaat_name)))),i?c.a.createElement("div",{className:"flex justify-center my-8"},c.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading data...")):g?c.a.createElement("div",{className:"text-center py-8"},c.a.createElement("p",{className:"text-red-600"},g),c.a.createElement("button",{onClick:D,className:"mt-4 bg-purple-600 text-white px-4 py-2 rounded"},"Retry")):c.a.createElement("div",{className:"overflow-x-auto"},c.a.createElement(s.TableContainer,{className:"mb-8 min-w-[600px]"},c.a.createElement(s.Table,null,c.a.createElement(s.TableHeader,null,c.a.createElement("tr",null,c.a.createElement(s.TableCell,null,"ID"),c.a.createElement(s.TableCell,null,"Name"),c.a.createElement(s.TableCell,null,"ITS"),c.a.createElement(s.TableCell,null,"Zone"),c.a.createElement(s.TableCell,null,"Sub Zone"),c.a.createElement(s.TableCell,{className:"text-right"},"Actions"))),c.a.createElement(s.TableBody,null,null===a||void 0===a?void 0:a.map((t,a)=>c.a.createElement(s.TableRow,{key:t.id},c.a.createElement(s.TableCell,null,c.a.createElement("span",{className:"text-sm"},a+1)),c.a.createElement(s.TableCell,null,c.a.createElement("span",{className:"text-sm font-medium"},t.full_name||"N/A")),c.a.createElement(s.TableCell,null,c.a.createElement("span",{className:"text-sm"},t.its)),c.a.createElement(s.TableCell,null,t.is_attendance&&(null===w||void 0===w?void 0:w.id)===t.id?c.a.createElement("select",{value:S,onChange:e=>z(parseInt(e.target.value)),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100"},c.a.createElement("option",{value:""},"Select Zone"),T.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name))):c.a.createElement("span",{className:"text-sm"},t.zone_name)),c.a.createElement(s.TableCell,null,t.is_attendance&&(null===w||void 0===w?void 0:w.id)===t.id?c.a.createElement("select",{value:_,onChange:e=>q(parseInt(e.target.value)),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100"},c.a.createElement("option",{value:""},"Select Sub-zone"),A.map(e=>c.a.createElement("option",{key:e.id,value:e.id},e.name))):c.a.createElement("span",{className:"text-sm"},t.sub_zone_name)),c.a.createElement(s.TableCell,{className:"text-right"},t.is_attendance?c.a.createElement("div",{className:"flex flex-wrap justify-end gap-2"},(null===w||void 0===w?void 0:w.id)===t.id?c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:M,className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-600 flex items-center space-x-1"},c.a.createElement(o.d,{className:"h-4 w-4"}),c.a.createElement("span",{className:"text-sm"},"Save")),c.a.createElement("button",{onClick:()=>{j(null),z(null),q(null)},className:"text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300 flex items-center space-x-1"},c.a.createElement("span",{className:"text-sm"},"Cancel"))):c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:()=>{return j(e=t),z(e.zone),void q(e.sub_zone);var e},className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-600 flex items-center space-x-1"},c.a.createElement(o.d,{className:"h-4 w-4"}),c.a.createElement("span",{className:"text-sm"},"Edit")),c.a.createElement("button",{onClick:()=>(async e=>{try{window.confirm("Are you sure?")&&(await Object(l.a)("/miqaat-attendance/".concat(e,"/")),d.a.success("Deleted"),D())}catch(t){d.a.error("Delete failed")}})(t.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-600 flex items-center space-x-1"},c.a.createElement(o.b,{className:"h-4 w-4"}),c.a.createElement("span",{className:"text-sm"},"Delete")))):c.a.createElement("div",{className:"flex flex-wrap justify-end gap-2"},c.a.createElement("button",{onClick:()=>(async t=>{try{await Object(l.e)("/miqaat-attendance/",{member:t.id,miqaat:parseInt(e,10),zone:t.zone,sub_zone:t.sub_zone});d.a.success("Attendance created successfully"),D()}catch(g){console.error("Failed to create attendance:",g),d.a.error("Failed to create attendance. Please try again.")}})(t),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-600 flex items-center space-x-1"},c.a.createElement(o.e,{className:"w-4 h-4"}),c.a.createElement("span",{className:"text-sm"},"save")))))))))),k&&c.a.createElement(u,{isOpen:k,onClose:()=>{x(!1)},miqaatId:e,onSuccess:()=>{D()}}),f&&w&&c.a.createElement(E,{isOpen:f,onClose:()=>{N(!1),j(null)},miqaatId:e,attendanceData:w,onSuccess:()=>{D()}})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return o})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return d})),a.d(t,"g",(function(){return u}));var n=a(109);let c="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),c="https://rms-v2.duckdns.org/api";const r=n.a.create({baseURL:c,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const l=async(e,t)=>r.get(e,{params:t}).then(e=>e.data),s=async(e,t)=>r.post(e,t).then(e=>e.data),o=async(e,t)=>r.put(e,t).then(e=>e.data),m=async(e,t)=>r.patch(e,t).then(e=>e.data),i=async e=>r.delete(e).then(e=>e.data),d=async(e,t)=>{try{const a=await r.get(e,{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),c=window.URL.createObjectURL(n),l=document.createElement("a");l.href=c,l.setAttribute("download",t),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(c)}catch(a){throw console.error("Download failed:",a),a}},u=async(e,t)=>{try{return(await r.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}}}]);
//# sourceMappingURL=28.9edd3b1f.chunk.js.map