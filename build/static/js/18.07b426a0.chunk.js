(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[18],{121:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(1),c=a(40),s=a(45),o=a(17),m=a(44),i=a(11),d=a(18),u=a.n(d);var p=function(e){let{isOpen:t,onClose:a,onCounterCreated:r}=e;const[s,m]=Object(n.useState)({name:"",zone:""}),[d,p]=Object(n.useState)([]),[E,b]=Object(n.useState)(!1),[y,f]=Object(n.useState)({});Object(n.useEffect)(()=>{t&&(m({name:"",zone:""}),f({}))},[t]),Object(n.useEffect)(()=>{t&&(async()=>{try{const e=await Object(c.c)("/zone/list/");p(e)}catch(e){console.error("Error fetching zones:",e),u.a.error("Failed to load zones")}})()},[t]);const x=e=>{const{name:t,value:a}=e.target;m(e=>Object(i.a)(Object(i.a)({},e),{},{[t]:a}))},h=async e=>{if(e.preventDefault(),(()=>{const e={};return s.name.trim()||(e.name="Counter name is required"),s.zone||(e.zone="Zone is required"),f(e),0===Object.keys(e).length})())try{b(!0);const e={name:s.name.trim(),zone:parseInt(s.zone)};await Object(c.e)("/counter/",e),u.a.success("Counter created successfully"),r&&r(),a()}catch(t){console.error("Error creating counter:",t),f({submit:"Failed to create counter. Please try again."})}finally{b(!1)}};return l.a.createElement(o.Modal,{isOpen:t,onClose:a},l.a.createElement(o.ModalHeader,null,"Create New Counter"),l.a.createElement(o.ModalBody,null,l.a.createElement("form",{onSubmit:h},l.a.createElement("div",{className:"mb-4"},l.a.createElement(o.Label,null,l.a.createElement("span",null,"Counter Name *"),l.a.createElement(o.Input,{className:"mt-1",name:"name",value:s.name,onChange:x,placeholder:"Enter counter name"}),y.name&&l.a.createElement("span",{className:"text-xs text-red-600"},y.name))),l.a.createElement("div",{className:"mb-4"},l.a.createElement(o.Label,null,l.a.createElement("span",null,"Zone *"),l.a.createElement(o.Select,{className:"mt-1",name:"zone",value:s.zone,onChange:x},l.a.createElement("option",{value:""},"Select a zone"),d.map(e=>l.a.createElement("option",{key:e.id,value:e.id},e.name))),y.zone&&l.a.createElement("span",{className:"text-xs text-red-600"},y.zone))),y.submit&&l.a.createElement("div",{className:"mb-4"},l.a.createElement("p",{className:"text-sm text-red-600"},y.submit)))),l.a.createElement(o.ModalFooter,null,l.a.createElement("div",{className:"flex flex-col space-y-2 sm:space-y-0 sm:space-x-2 sm:flex-row"},l.a.createElement(o.Button,{onClick:h,disabled:E},E?"Creating...":"Create Counter"))))};var E=function(e){let{isOpen:t,onClose:a,onCounterUpdated:r,counterData:s}=e;const[m,d]=Object(n.useState)({name:"",zone:""}),[p,E]=Object(n.useState)([]),[b,y]=Object(n.useState)(!0),[f,x]=Object(n.useState)(!1),[h,N]=Object(n.useState)({});Object(n.useEffect)(()=>{t&&(async()=>{try{y(!0);const e=await Object(c.c)("/zone/list/");E(e)}catch(e){console.error("Error fetching zones:",e),u.a.error("Failed to load zones")}finally{y(!1)}})()},[t]),Object(n.useEffect)(()=>{t&&s&&(d({name:s.name||"",zone:s.zone_id?s.zone_id.toString():""}),N({}))},[t,s]);const g=e=>{const{name:t,value:a}=e.target;d(e=>Object(i.a)(Object(i.a)({},e),{},{[t]:a}))},w=async e=>{if(e.preventDefault(),(()=>{const e={};return m.name.trim()||(e.name="Counter name is required"),m.zone||(e.zone="Zone is required"),N(e),0===Object.keys(e).length})())try{x(!0);const e={name:m.name.trim(),zone:parseInt(m.zone)};await Object(c.d)("/counter/".concat(s.id,"/"),e),u.a.success("Counter updated successfully"),r&&r(),a()}catch(t){console.error("Error updating counter:",t),N({submit:"Failed to update counter. Please try again."})}finally{x(!1)}};return l.a.createElement(o.Modal,{isOpen:t,onClose:a},l.a.createElement(o.ModalHeader,null,"Edit Counter"),l.a.createElement(o.ModalBody,null,b?l.a.createElement("div",{className:"text-center py-4"},l.a.createElement("p",{className:"text-gray-700 dark:text-gray-300"},"Loading zones...")):0===p.length?l.a.createElement("div",{className:"text-center py-4"},l.a.createElement("p",{className:"text-red-600 dark:text-red-400"},"No zones available")):l.a.createElement("form",{onSubmit:w},l.a.createElement("div",{className:"mb-4"},l.a.createElement(o.Label,null,l.a.createElement("span",null,"Counter Name *"),l.a.createElement(o.Input,{className:"mt-1",name:"name",value:m.name,onChange:g,placeholder:"Enter counter name"}),h.name&&l.a.createElement("span",{className:"text-xs text-red-600"},h.name))),l.a.createElement("div",{className:"mb-4"},l.a.createElement(o.Label,null,l.a.createElement("span",null,"Zone *"),l.a.createElement(o.Select,{className:"mt-1",name:"zone",value:m.zone,onChange:g},l.a.createElement("option",{value:""},"Select a zone"),p.map(e=>l.a.createElement("option",{key:e.id,value:e.id.toString()},e.name))),h.zone&&l.a.createElement("span",{className:"text-xs text-red-600"},h.zone))),h.submit&&l.a.createElement("div",{className:"mb-4"},l.a.createElement("p",{className:"text-sm text-red-600"},h.submit)))),l.a.createElement(o.ModalFooter,null,l.a.createElement("div",{className:"flex flex-col space-y-2 sm:space-y-0 sm:space-x-2 sm:flex-row"},l.a.createElement(o.Button,{onClick:w,disabled:f||b||0===p.length},f?"Updating...":"Update Counter"))))},b=a(41),y=a.n(b);t.default=function(){Object(r.g)();const[e,t]=Object(n.useState)([]),[a,i]=Object(n.useState)(!0),[d,b]=Object(n.useState)(null),[f,x]=Object(n.useState)(!1),[h,N]=Object(n.useState)(!1),[g,w]=Object(n.useState)(null),[v,C]=Object(n.useState)(0),[j,O]=Object(n.useState)(null);Object(n.useEffect)(()=>{(async()=>{try{i(!0);const e=await Object(c.c)("/counter/list/");t(e)}catch(e){console.error("Error fetching counter data:",e),b("Failed to load counter data")}finally{i(!1)}})()},[v]);const k=e=>{w(e),N(!0),O(null)},z=async e=>{try{window.confirm("Are you sure you want to delete this counter?")&&(await Object(c.a)("/counter/".concat(e,"/")),t(t=>t.filter(t=>t.id!==e)),u.a.success("Counter deleted successfully"))}catch(d){console.error("Error deleting counter:",d),u.a.error("Failed to delete counter. Please try again.")}},S=e=>{O(j===e?null:e)};return l.a.createElement("div",{className:"relative w-full px-4 py-6"},l.a.createElement("img",{src:y.a,alt:"Watermark",className:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",position:"absolute",transform:"translate(-50%, -50%)",width:"70vw",maxWidth:"400px",height:"auto",opacity:.05,zIndex:0}}),l.a.createElement("div",{className:"relative z-10"},"      ",l.a.createElement("div",{className:"flex items-center justify-between mb-6"},l.a.createElement(s.a,null,"Counters"),l.a.createElement("button",{onClick:()=>{x(!0)},className:"flex items-center bg-purple-600 text-white rounded-lg",style:{fontSize:window.innerWidth<768?"0.875rem":"1rem",padding:window.innerWidth<768?"0.5rem 1rem":"0.75rem 1rem"}},l.a.createElement(m.e,{className:"mr-1 ".concat(window.innerWidth<768?"w-3 h-3":"w-4 h-4")}),"Add Counter")),a?l.a.createElement("div",{className:"flex justify-center my-8"},l.a.createElement("p",{className:"text-gray-700 dark:text-gray-300"},"Loading data...")):d?l.a.createElement("div",{className:"text-center py-8"},l.a.createElement("p",{className:"text-red-600 dark:text-red-400"},d)):l.a.createElement(l.a.Fragment,null,l.a.createElement(o.TableContainer,{className:"hidden md:block mb-8"},l.a.createElement(o.Table,null,l.a.createElement(o.TableHeader,null,l.a.createElement("tr",null,l.a.createElement(o.TableCell,null,"ID"),l.a.createElement(o.TableCell,null,"Name"),l.a.createElement(o.TableCell,null,"Zone"),l.a.createElement(o.TableCell,null,"Actions"))),l.a.createElement(o.TableBody,null,e.map((e,t)=>l.a.createElement(o.TableRow,{key:e.id},l.a.createElement(o.TableCell,null,l.a.createElement("span",{className:"text-sm font-semibold"},t+1)),l.a.createElement(o.TableCell,null,l.a.createElement("span",{className:"text-sm"},e.name)),l.a.createElement(o.TableCell,null,l.a.createElement("span",{className:"text-sm"},e.zone_name||"N/A")),l.a.createElement(o.TableCell,null,l.a.createElement("div",{className:"flex items-center space-x-4"},l.a.createElement(o.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>k(e)},l.a.createElement(m.d,{className:"w-5 h-5","aria-hidden":"true"})),l.a.createElement(o.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>z(e.id)},l.a.createElement(m.b,{className:"w-5 h-5","aria-hidden":"true"}))))))))),l.a.createElement("div",{className:"md:hidden space-y-3"},0===e.length?l.a.createElement("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400"},"No counters found"):e.map((e,t)=>l.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 hover:border-purple-200 dark:hover:border-purple-700 transition-colors"},l.a.createElement("div",{className:"flex items-center p-3 cursor-pointer",onClick:()=>S(e.id)},l.a.createElement("div",{className:"h-12 w-12 mr-3 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 \r flex items-center justify-center font-medium"},t+1),l.a.createElement("div",{className:"flex-1 min-w-0"},l.a.createElement("div",{className:"flex items-center justify-between"},l.a.createElement("p",{className:"font-medium dark:text-white truncate"},e.name))),l.a.createElement("button",{onClick:()=>S(e.id),className:"text-gray-600 dark:text-gray-300"},j===e.id?l.a.createElement(m.g,{className:"h-5 w-5"}):l.a.createElement(m.c,{className:"h-5 w-5"}))),j===e.id&&l.a.createElement("div",{className:"px-4 pb-4 pt-0 border-t dark:border-gray-700"},l.a.createElement("div",{className:"mt-2 space-y-2"},l.a.createElement("div",null,l.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Zone"),l.a.createElement("p",{className:"text-sm dark:text-white"},e.zone_name||"N/A")),l.a.createElement("div",{className:"flex justify-end space-x-2 mt-2"},l.a.createElement("button",{onClick:()=>k(e),className:"bg-blue-600 text-white px-3 py-1 rounded-md text-xs flex items-center"},l.a.createElement(m.d,{className:"mr-1 h-3 w-3"})," Edit"),l.a.createElement("button",{onClick:()=>z(e.id),className:"bg-red-600 text-white px-3 py-1 rounded-md text-xs flex items-center"},l.a.createElement(m.b,{className:"mr-1 h-3 w-3"})," Delete")))))))),l.a.createElement(p,{isOpen:f,onClose:()=>{x(!1)},onCounterCreated:()=>{C(e=>e+1)}}),g&&l.a.createElement(E,{isOpen:h,onClose:()=>{N(!1),w(null)},onCounterUpdated:()=>{C(e=>e+1)},counterData:g})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return o})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return d})),a.d(t,"g",(function(){return u}));var n=a(109);let l="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),l="https://rms-v2.duckdns.org/api";const r=n.a.create({baseURL:l,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const c=async(e,t)=>r.get(e,{params:t}).then(e=>e.data),s=async(e,t)=>r.post(e,t).then(e=>e.data),o=async(e,t)=>r.put(e,t).then(e=>e.data),m=async(e,t)=>r.patch(e,t).then(e=>e.data),i=async e=>r.delete(e).then(e=>e.data),d=async(e,t)=>{try{const a=await r.get(e,{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.setAttribute("download",t),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(l)}catch(a){throw console.error("Download failed:",a),a}},u=async(e,t)=>{try{return(await r.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}},45:function(e,t,a){"use strict";var n=a(0),l=a.n(n);t.a=function(e){let{children:t}=e;return l.a.createElement("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"},t)}}}]);
//# sourceMappingURL=18.07b426a0.chunk.js.map