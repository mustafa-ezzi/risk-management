(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[27],{113:function(e,t,a){"use strict";a.r(t);var n=a(11),l=a(0),r=a.n(l),c=a(1),o=a(40),s=a(17),m=a(44);var i=e=>{let{isOpen:t,onClose:a,miqaatId:c,onSuccess:m}=e;const[i,d]=Object(l.useState)({menu:"",unit:"",container:"",total_cooked:"",total_received:"",zone:""}),[u,p]=Object(l.useState)({menus:[],units:[],containers:[],zones:[]}),[b,E]=Object(l.useState)(!1),[g,v]=Object(l.useState)(null);Object(l.useEffect)(()=>{t&&(async()=>{try{const[e,t,a,n]=await Promise.all([Object(o.c)("/menu/list/"),Object(o.c)("/unit/list/"),Object(o.c)("/container/list/"),Object(o.c)("/zone/list/")]);p({menus:e,units:t,containers:a,zones:n})}catch(e){console.error("Error fetching dropdown options:",e),v("Failed to load dropdown options")}})()},[t]);const y=e=>{const{name:t,value:a}=e.target;d(e=>Object(n.a)(Object(n.a)({},e),{},{[t]:a}))},x=async e=>{e.preventDefault(),E(!0),v(null);try{const e=Object(n.a)(Object(n.a)({},i),{},{miqaat:c}),t=["menu","unit","container","total_cooked","total_received","zone"].filter(t=>!e[t]);if(t.length>0)return v("Please fill in all required fields: ".concat(t.join(", "))),void E(!1);e.menu=parseInt(e.menu,10),e.unit=parseInt(e.unit,10),e.container=parseInt(e.container,10),e.zone=parseInt(e.zone,10),e.total_cooked=parseInt(e.total_cooked,10),e.total_received=parseInt(e.total_received,10),e.miqaat=parseInt(e.miqaat,10);const l=await Object(o.e)("/leftover-degs/",e);m(l),d({menu:"",unit:"",container:"",total_cooked:"",total_received:"",zone:""}),a()}catch(l){var t;if(console.error("Error creating leftover degs:",l),null===(t=l.response)||void 0===t?void 0:t.data){const e=[],t=l.response.data;Object.keys(t).forEach(a=>{Array.isArray(t[a])&&e.push("".concat(a,": ").concat(t[a].join(", ")))}),e.length>0?v(e.join("; ")):v("Failed to create leftover degs. Please check your input.")}else v("Failed to create leftover degs")}finally{E(!1)}};return r.a.createElement(s.Modal,{isOpen:t,onClose:a},r.a.createElement(s.ModalHeader,null,"Create Leftover Degs"),r.a.createElement(s.ModalBody,null,g&&r.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},r.a.createElement("span",{className:"block sm:inline"},g)),r.a.createElement("form",{onSubmit:x},r.a.createElement("div",{className:"grid grid-cols-2 gap-4"},r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Menu"),r.a.createElement(s.Select,{name:"menu",value:i.menu,onChange:y,className:"mt-1",required:!0},r.a.createElement("option",{value:""},"Select Menu"),u.menus.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Unit"),r.a.createElement(s.Select,{name:"unit",value:i.unit,onChange:y,className:"mt-1",required:!0},r.a.createElement("option",{value:""},"Select Unit"),u.units.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Container"),r.a.createElement(s.Select,{name:"container",value:i.container,onChange:y,className:"mt-1",required:!0},r.a.createElement("option",{value:""},"Select Container"),u.containers.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Zone"),r.a.createElement(s.Select,{name:"zone",value:i.zone,onChange:y,className:"mt-1",required:!0},r.a.createElement("option",{value:""},"Select Zone"),u.zones.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Total Cooked"),r.a.createElement(s.Input,{type:"number",name:"total_cooked",value:i.total_cooked,onChange:y,placeholder:"Enter total cooked",className:"mt-1",required:!0})),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Total Received"),r.a.createElement(s.Input,{type:"number",name:"total_received",value:i.total_received,onChange:y,placeholder:"Enter total received",className:"mt-1",required:!0}))))),r.a.createElement(s.ModalFooter,null,r.a.createElement("div",{className:"hidden sm:block"},r.a.createElement(s.Button,{onClick:x,disabled:b},b?"Creating...":"Create")),r.a.createElement("div",{className:"w-full sm:hidden"},r.a.createElement(s.Button,{block:!0,size:"large",onClick:x,disabled:b},b?"Creating...":"Create"))))},d=a(18),u=a.n(d);var p=e=>{let{isOpen:t,onClose:a,miqaatId:c,leftoverDegsData:m,onSuccess:i}=e;const[d,p]=Object(l.useState)({miqaat:c,zone:"",menu:"",unit:"",container:"",total_cooked:"",total_received:""}),[b,E]=Object(l.useState)({zones:[],menus:[],units:[],containers:[]}),[g,v]=Object(l.useState)(!1),[y,x]=Object(l.useState)(null),[k,N]=Object(l.useState)(!1);Object(l.useEffect)(()=>{t&&(async()=>{N(!0);try{const[e,t,a,n]=await Promise.all([Object(o.c)("/zone/list/"),Object(o.c)("/menu/list/"),Object(o.c)("/unit/list/"),Object(o.c)("/container/list/")]);E({zones:Array.isArray(e)?e:e.results||[],menus:Array.isArray(t)?t:t.results||[],units:Array.isArray(a)?a:a.results||[],containers:Array.isArray(n)?n:n.results||[]})}catch(e){console.error("Error fetching dropdown options:",e),x("Failed to load dropdown options")}finally{N(!1)}})()},[t]),Object(l.useEffect)(()=>{var e,t,a,n,l,r,o,s;m&&!k&&p({miqaat:c,zone:m.zone_id||(null!==(e=null===(t=m.zone)||void 0===t?void 0:t.id)&&void 0!==e?e:""),menu:m.menu_id||(null!==(a=null===(n=m.menu)||void 0===n?void 0:n.id)&&void 0!==a?a:""),unit:m.unit_id||(null!==(l=null===(r=m.unit)||void 0===r?void 0:r.id)&&void 0!==l?l:""),container:m.container_id||(null!==(o=null===(s=m.container)||void 0===s?void 0:s.id)&&void 0!==o?o:""),total_cooked:m.total_cooked||"",total_received:m.total_received||""})},[m,c,k]);const f=e=>{const{name:t,value:a}=e.target;p(e=>Object(n.a)(Object(n.a)({},e),{},{[t]:a}))},h=async e=>{e.preventDefault(),v(!0),x(null);try{const e=["zone","menu","unit","container","total_cooked","total_received"].filter(e=>!d[e]);if(e.length>0)throw new Error("Please fill in all required fields: ".concat(e.join(", ")));if(!b.zones.some(e=>e.id===parseInt(d.zone)))throw new Error("Please select a valid zone");if(!b.menus.some(e=>e.id===parseInt(d.menu)))throw new Error("Please select a valid menu");if(!b.units.some(e=>e.id===parseInt(d.unit)))throw new Error("Please select a valid unit");if(!b.containers.some(e=>e.id===parseInt(d.container)))throw new Error("Please select a valid container");const t=parseInt(d.total_cooked),l=parseInt(d.total_received);if(isNaN(t)||t<0)throw new Error("Total cooked must be a non-negative number");if(isNaN(l)||l<0)throw new Error("Total received must be a non-negative number");const r=Object(n.a)(Object(n.a)({},d),{},{miqaat:parseInt(c),zone:parseInt(d.zone),menu:parseInt(d.menu),unit:parseInt(d.unit),container:parseInt(d.container),total_cooked:t,total_received:l});await Object(o.d)("/leftover-degs/".concat(m.id,"/"),r),u.a.success("Leftover degs record updated successfully"),i(),a()}catch(r){var t,l;console.error("Error updating leftover degs record:",r),x(r.message||(null===(t=r.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.message)||"Failed to update leftover degs record")}finally{v(!1)}};return r.a.createElement(s.Modal,{isOpen:t,onClose:a},r.a.createElement(s.ModalHeader,null,"Edit Leftover Degs Record"),r.a.createElement(s.ModalBody,null,y&&r.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},r.a.createElement("span",{className:"block sm:inline"},y)),k?r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading options..."):r.a.createElement("form",{onSubmit:h},r.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Zone *"),r.a.createElement(s.Select,{name:"zone",value:d.zone,onChange:f,className:"mt-1",required:!0,disabled:g},r.a.createElement("option",{value:""},"Select Zone"),b.zones.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Menu *"),r.a.createElement(s.Select,{name:"menu",value:d.menu,onChange:f,className:"mt-1",required:!0,disabled:g},r.a.createElement("option",{value:""},"Select Menu"),b.menus.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Unit *"),r.a.createElement(s.Select,{name:"unit",value:d.unit,onChange:f,className:"mt-1",required:!0,disabled:g},r.a.createElement("option",{value:""},"Select Unit"),b.units.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Container *"),r.a.createElement(s.Select,{name:"container",value:d.container,onChange:f,className:"mt-1",required:!0,disabled:g},r.a.createElement("option",{value:""},"Select Container"),b.containers.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Total Cooked *"),r.a.createElement(s.Input,{type:"number",name:"total_cooked",value:d.total_cooked,onChange:f,className:"mt-1",placeholder:"Enter total cooked",min:"0",required:!0,disabled:g})),r.a.createElement(s.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Total Received *"),r.a.createElement(s.Input,{type:"number",name:"total_received",value:d.total_received,onChange:f,className:"mt-1",placeholder:"Enter total received",min:"0",required:!0,disabled:g}))))),r.a.createElement(s.ModalFooter,null,r.a.createElement("div",{className:"hidden sm:block"},r.a.createElement(s.Button,{onClick:h,disabled:g||k},g?"Updating...":"Update")),r.a.createElement("div",{className:"w-full sm:hidden"},r.a.createElement(s.Button,{block:!0,size:"large",onClick:h,disabled:g||k},g?"Updating...":"Update"))))},b=a(41),E=a.n(b);t.default=function(){var e;const{id:t}=Object(c.i)(),a=Object(c.g)(),[d,b]=Object(l.useState)(null),[g,v]=Object(l.useState)(!0),[y,x]=Object(l.useState)(null),[k,N]=Object(l.useState)(null),[f,h]=Object(l.useState)(!1),[w,C]=Object(l.useState)(!1),[j,_]=Object(l.useState)(null),[O,S]=Object(l.useState)(null);Object(l.useEffect)(()=>{z(),T()},[t]);const z=async()=>{v(!0),x(null);try{const e=await Object(o.c)("/leftover-degs/".concat(t,"/"));b(e)}catch(e){console.error("Error fetching leftover degs data:",e),x("Failed to load leftover degs data. Please try again.")}finally{v(!1)}},T=async()=>{try{const e=await Object(o.c)("/miqaat/".concat(t,"/"));N(e)}catch(e){console.error("Error fetching miqaat details:",e)}},I=e=>{_(e),C(!0)},q=async e=>{try{window.confirm("Are you sure you want to delete this leftover degs record?")&&(await Object(o.a)("/leftover-degs/".concat(e,"/")),b(t=>Object(n.a)(Object(n.a)({},t),{},{leftover_degs:t.leftover_degs.filter(t=>t.id!==e)})),u.a.success("Leftover degs record deleted successfully"))}catch(y){console.error("Error deleting leftover degs record:",y),u.a.error("Failed to delete leftover degs record. Please try again.")}},A=e=>{S(O===e?null:e)};return r.a.createElement("div",{className:"relative w-full px-4 py-6"},r.a.createElement("img",{src:E.a,alt:"Watermark",className:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",position:"absolute",transform:"translate(-50%, -50%)",width:"70vw",maxWidth:"400px",height:"auto",opacity:.05,zIndex:0}}),r.a.createElement("div",{className:"relative z-10"},"      ",r.a.createElement("div",{className:"flex items-center justify-between mb-6"},r.a.createElement("div",{className:"flex items-center"},r.a.createElement("button",{onClick:()=>{a.goBack()},className:"mr-4"},r.a.createElement(m.a,{className:"w-5 h-5 dark:text-white"})),r.a.createElement("h1",{style:{fontSize:window.innerWidth<768?"1.25rem":"1.5rem"},className:"font-semibold dark:text-white"},"Leftover Degs",k&&" - ".concat(k.miqaat_name))),r.a.createElement("button",{onClick:()=>{h(!0)},className:"flex items-center bg-purple-600 text-white rounded-lg",style:{fontSize:window.innerWidth<768?"0.875rem":"1rem",padding:window.innerWidth<768?"0.5rem 1rem":"0.75rem 1rem"}},r.a.createElement(m.e,{className:"mr-1 ".concat(window.innerWidth<768?"w-3 h-3":"w-4 h-4")}),"Add")),g?r.a.createElement("div",{className:"flex justify-center my-8"},r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading data...")):y?r.a.createElement("div",{className:"text-center py-8"},r.a.createElement("p",{className:"text-red-600"},y),r.a.createElement("button",{onClick:z,className:"mt-4 bg-purple-600 text-white px-4 py-2 rounded"},"Retry")):r.a.createElement(r.a.Fragment,null,r.a.createElement(s.TableContainer,{className:"hidden md:block mb-8"},r.a.createElement(s.Table,null,r.a.createElement(s.TableHeader,null,r.a.createElement("tr",null,r.a.createElement(s.TableCell,null,"ID"),r.a.createElement(s.TableCell,null,"Menu"),r.a.createElement(s.TableCell,null,"Container"),r.a.createElement(s.TableCell,null,"Unit"),r.a.createElement(s.TableCell,null,"Total Cooked"),r.a.createElement(s.TableCell,null,"Total Received"),r.a.createElement(s.TableCell,null,"Zone"),r.a.createElement(s.TableCell,{className:"text-right"},"Actions"))),r.a.createElement(s.TableBody,null,null===d||void 0===d||null===(e=d.leftover_degs)||void 0===e?void 0:e.map((e,t)=>r.a.createElement(s.TableRow,{key:e.id},r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm"},t+1)),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},e.menu_name||"N/A")),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm"},e.container_name||"N/A")),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm"},e.unit_name||"N/A")),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},null!=e.total_cooked?e.total_cooked:"N/A")),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},null!=e.total_received?e.total_received:"N/A")),r.a.createElement(s.TableCell,null,r.a.createElement("span",{className:"text-sm"},e.zone_name||"N/A")),r.a.createElement(s.TableCell,{className:"text-right"},r.a.createElement("button",{onClick:()=>I(e),className:"text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-500 mr-2"},r.a.createElement(m.d,{className:"h-4 w-4 inline-block"})),r.a.createElement("button",{onClick:()=>q(e.id),className:"text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-500"},r.a.createElement(m.b,{className:"h-4 w-4 inline-block"})))))))),r.a.createElement("div",{className:"md:hidden space-y-3"},(null===d||void 0===d?void 0:d.leftover_degs)&&0!==d.leftover_degs.length?d.leftover_degs.map((e,t)=>r.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700"},r.a.createElement("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>A(e.id)},r.a.createElement("div",{className:"flex items-center space-x-3"},r.a.createElement("div",{className:"bg-gray-100 dark:bg-gray-700 h-8 w-8 rounded-full flex items-center justify-center text-gray-700 dark:text-gray-300 font-medium"},t+1),r.a.createElement("div",{className:"font-medium text-gray-800 dark:text-gray-200"},e.menu_name||"N/A")),r.a.createElement("button",{onClick:t=>{t.stopPropagation(),A(e.id)},className:"text-gray-600 dark:text-gray-400"},r.a.createElement(m.c,{className:"h-4 w-4 transition-transform ".concat(O===e.id?"rotate-180":"")}))),O===e.id&&r.a.createElement("div",{className:"px-4 pb-4 pt-0 border-t dark:border-gray-700"},r.a.createElement("div",{className:"mt-2 space-y-2"},r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Container:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.container_name||"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Unit:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.unit_name||"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Total Cooked:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},null!=e.total_cooked?e.total_cooked:"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Total Received:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},null!=e.total_received?e.total_received:"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Zone:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.zone_name||"N/A"))),r.a.createElement("div",{className:"mt-4 flex justify-end space-x-2"},r.a.createElement("button",{onClick:()=>I(e),className:"text-white px-4 py-1 rounded-md bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 flex items-center"},r.a.createElement(m.d,{className:"h-4 w-4 mr-1"}),"Edit"),r.a.createElement("button",{onClick:()=>q(e.id),className:"text-white px-4 py-1 rounded-md bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 flex items-center"},r.a.createElement(m.b,{className:"h-4 w-4 mr-1"}),"Delete"))))):r.a.createElement("div",{className:"text-center py-8"},r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"No leftover degs records found")))),f&&r.a.createElement(i,{isOpen:f,onClose:()=>{h(!1)},miqaatId:t,onSuccess:z}),w&&j&&r.a.createElement(p,{isOpen:w,onClose:()=>{C(!1),_(null)},miqaatId:t,leftoverDegsData:j,onSuccess:z})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"f",(function(){return s})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return d})),a.d(t,"g",(function(){return u}));var n=a(109);let l="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),l="http://35.172.211.35/api";const r=n.a.create({baseURL:l,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const c=async(e,t)=>r.get(e,{params:t}).then(e=>e.data),o=async(e,t)=>r.post(e,t).then(e=>e.data),s=async(e,t)=>r.put(e,t).then(e=>e.data),m=async(e,t)=>r.patch(e,t).then(e=>e.data),i=async e=>r.delete(e).then(e=>e.data),d=async(e,t)=>{try{const a=await r.get(e,{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.setAttribute("download",t),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(l)}catch(a){throw console.error("Download failed:",a),a}},u=async(e,t)=>{try{return(await r.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}}}]);
//# sourceMappingURL=27.493ada6b.chunk.js.map