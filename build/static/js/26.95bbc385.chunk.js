(this["webpackJsonpwindmill-dashboard-react"]=this["webpackJsonpwindmill-dashboard-react"]||[]).push([[26],{111:function(e,t,a){"use strict";a.r(t);var n=a(11),l=a(0),r=a.n(l),c=a(1),o=a(40),i=a(17),s=a(44);var m=function(e){let{isOpen:t,onClose:a,onSuccess:s}=e;const{id:m}=Object(c.i)(),[u,d]=Object(l.useState)({miqaat:m||"",zone:"",counter_packing:"",ibadullah_count:0,mumin_count:0}),[b,p]=Object(l.useState)(!1),[g,E]=Object(l.useState)(""),[y,h]=Object(l.useState)([]),[x,k]=Object(l.useState)([]);Object(l.useEffect)(()=>{t&&(N(),v())},[t,m]);const N=async()=>{try{const e=await Object(o.c)("/zone/list/");h(e)}catch(g){console.error("Error fetching zones:",g),E("Failed to load zones data")}},v=async()=>{try{let e="/counter-packing/".concat(m,"/");const t=await Object(o.c)(e);k(t.counter_packing)}catch(g){console.error("Error fetching counter packings:",g),E("Failed to load counter packings data")}},f=e=>{const{name:t,value:a}=e.target;d(e=>Object(n.a)(Object(n.a)({},e),{},{[t]:a}))},_=async e=>{e.preventDefault(),p(!0),E("");try{const e=Object(n.a)(Object(n.a)({},u),{},{ibadullah_count:parseInt(u.ibadullah_count,10),mumin_count:parseInt(u.mumin_count,10),miqaat:parseInt(u.miqaat,10),zone:parseInt(u.zone,10),counter_packing:parseInt(u.counter_packing,10)}),t=await Object(o.e)("/distribution/",e);d({miqaat:m||"",zone:"",counter_packing:"",ibadullah_count:0,mumin_count:0}),s(t),a()}catch(g){console.error("Error creating distribution:",g),E("Failed to create distribution. Please try again.")}finally{p(!1)}};return r.a.createElement(i.Modal,{isOpen:t,onClose:a},r.a.createElement(i.ModalHeader,null,"Add New Distribution"),r.a.createElement(i.ModalBody,null,g&&r.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},g),r.a.createElement("form",{onSubmit:_},r.a.createElement(i.Label,{className:"mt-4"},r.a.createElement("span",null,"Zone"),r.a.createElement(i.Select,{className:"mt-1",name:"zone",value:u.zone,onChange:f,required:!0},r.a.createElement("option",{value:"",disabled:!0},"Select a zone"),y.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(i.Label,{className:"mt-4"},r.a.createElement("span",null,"Counter Packing"),r.a.createElement(i.Select,{className:"mt-1",name:"counter_packing",value:u.counter_packing,onChange:f,required:!0},r.a.createElement("option",{value:"",disabled:!0},"Select a counter packing"),x.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.menu_name,",  Quantity: ",e.quantity," (Fill: ",e.filled_percentage,"%)")))),r.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},r.a.createElement(i.Label,null,r.a.createElement("span",null,"Ibadullah Count"),r.a.createElement(i.Input,{className:"mt-1",type:"number",name:"ibadullah_count",value:u.ibadullah_count,onChange:f,min:"0",required:!0})),r.a.createElement(i.Label,null,r.a.createElement("span",null,"Mumin Count"),r.a.createElement(i.Input,{className:"mt-1",type:"number",name:"mumin_count",value:u.mumin_count,onChange:f,min:"0",required:!0}))),r.a.createElement("input",{type:"hidden",name:"miqaat",value:u.miqaat}))),r.a.createElement(i.ModalFooter,null,r.a.createElement("div",{className:"flex justify-end space-x-2"},r.a.createElement(i.Button,{disabled:b,onClick:_},b?"Saving...":"Save"))))},u=a(18),d=a.n(u);var b=e=>{let{isOpen:t,onClose:a,miqaatId:c,distributionData:s,onSuccess:m}=e;const[u,b]=Object(l.useState)({miqaat:c,zone:"",counter_packing:"",ibadullah_count:"",mumin_count:""}),[p,g]=Object(l.useState)({zones:[],counter_packings:[]}),[E,y]=Object(l.useState)(!1),[h,x]=Object(l.useState)(null),[k,N]=Object(l.useState)(!1);Object(l.useEffect)(()=>{t&&(async()=>{N(!0);try{var e;const[t,a]=await Promise.all([Object(o.c)("/zone/list/"),Object(o.c)("/counter-packing/".concat(c,"/"))]);g({zones:Array.isArray(t)?t:t.results||[],counter_packings:Array.isArray(a.counter_packing)?a.counter_packing:(null===(e=a.counter_packing)||void 0===e?void 0:e.results)||[]})}catch(t){console.error("Error fetching dropdown options:",t),x("Failed to load dropdown options")}finally{N(!1)}})()},[t,c]),Object(l.useEffect)(()=>{var e,t,a,n;s&&!k&&b({miqaat:c,zone:s.zone_id||(null!==(e=null===(t=s.zone)||void 0===t?void 0:t.id)&&void 0!==e?e:""),counter_packing:s.counter_packing_id||(null!==(a=null===(n=s.counter_packing)||void 0===n?void 0:n.id)&&void 0!==a?a:""),ibadullah_count:s.ibadullah_count||"",mumin_count:s.mumin_count||""})},[s,c,k]);const v=e=>{const{name:t,value:a}=e.target;b(e=>Object(n.a)(Object(n.a)({},e),{},{[t]:a}))},f=async e=>{e.preventDefault(),y(!0),x(null);try{const e=["zone","counter_packing","ibadullah_count","mumin_count"].filter(e=>!u[e]);if(e.length>0)throw new Error("Please fill in all required fields: ".concat(e.join(", ")));if(!p.zones.some(e=>e.id===parseInt(u.zone)))throw new Error("Please select a valid zone");if(!p.counter_packings.some(e=>e.id===parseInt(u.counter_packing)))throw new Error("Please select a valid counter packing");const t=parseInt(u.ibadullah_count),l=parseInt(u.mumin_count);if(isNaN(t)||t<0)throw new Error("Ibadullah count must be a non-negative number");if(isNaN(l)||l<0)throw new Error("Mumin count must be a non-negative number");const r=Object(n.a)(Object(n.a)({},u),{},{miqaat:parseInt(c),zone:parseInt(u.zone),counter_packing:parseInt(u.counter_packing),ibadullah_count:t,mumin_count:l});await Object(o.d)("/distribution/".concat(s.id,"/"),r),d.a.success("Distribution record updated successfully"),m(),a()}catch(r){var t,l;console.error("Error updating distribution record:",r),x(r.message||(null===(t=r.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.message)||"Failed to update distribution record")}finally{y(!1)}};return r.a.createElement(i.Modal,{isOpen:t,onClose:a},r.a.createElement(i.ModalHeader,null,"Edit Distribution Record"),r.a.createElement(i.ModalBody,null,h&&r.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},r.a.createElement("span",{className:"block sm:inline"},h)),k?r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading options..."):r.a.createElement("form",{onSubmit:f},r.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},r.a.createElement(i.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Zone *"),r.a.createElement(i.Select,{name:"zone",value:u.zone,onChange:v,className:"mt-1",required:!0,disabled:E},r.a.createElement("option",{value:""},"Select Zone"),p.zones.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name)))),r.a.createElement(i.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Counter Packing *"),r.a.createElement(i.Select,{name:"counter_packing",value:u.counter_packing,onChange:v,className:"mt-1",required:!0,disabled:E},r.a.createElement("option",{value:""},"Select Counter Packing"),p.counter_packings.map(e=>r.a.createElement("option",{key:e.id,value:e.id},"Zone: ",e.zone_name,", Qty: ",e.quantity," (",e.filled_percentage,"%)")))),r.a.createElement(i.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Ibadullah Count *"),r.a.createElement(i.Input,{type:"number",name:"ibadullah_count",value:u.ibadullah_count,onChange:v,className:"mt-1",placeholder:"Enter Ibadullah count",min:"0",required:!0,disabled:E})),r.a.createElement(i.Label,{className:"block text-sm"},r.a.createElement("span",{className:"text-gray-700 dark:text-gray-400"},"Mumin Count *"),r.a.createElement(i.Input,{type:"number",name:"mumin_count",value:u.mumin_count,onChange:v,className:"mt-1",placeholder:"Enter Mumin count",min:"0",required:!0,disabled:E}))))),r.a.createElement(i.ModalFooter,null,r.a.createElement("div",{className:"hidden sm:block"},r.a.createElement(i.Button,{onClick:f,disabled:E||k},E?"Updating...":"Update")),r.a.createElement("div",{className:"w-full sm:hidden"},r.a.createElement(i.Button,{block:!0,size:"large",onClick:f,disabled:E||k},E?"Updating...":"Update"))))},p=a(41),g=a.n(p);t.default=function(){var e;const{id:t}=Object(c.i)(),a=Object(c.g)(),[u,p]=Object(l.useState)(null),[E,y]=Object(l.useState)(!0),[h,x]=Object(l.useState)(null),[k,N]=Object(l.useState)(null),[v,f]=Object(l.useState)(!1),[_,w]=Object(l.useState)(!1),[j,C]=Object(l.useState)(null),[O,S]=Object(l.useState)(null);Object(l.useEffect)(()=>{z(),q()},[t]);const z=async()=>{y(!0),x(null);try{const e=await Object(o.c)("/distribution/".concat(t,"/"));p(e)}catch(e){console.error("Error fetching distribution data:",e),x("Failed to load distribution data. Please try again.")}finally{y(!1)}},q=async()=>{try{const e=await Object(o.c)("/miqaat/".concat(t,"/"));N(e)}catch(e){console.error("Error fetching miqaat details:",e)}},I=e=>{C(e),w(!0)},T=async e=>{try{window.confirm("Are you sure you want to delete this distribution record?")&&(await Object(o.a)("/distribution/".concat(e,"/")),p(t=>Object(n.a)(Object(n.a)({},t),{},{distributions:t.distributions.filter(t=>t.id!==e)})),d.a.success("Distribution record deleted successfully"))}catch(h){console.error("Error deleting distribution record:",h),d.a.error("Failed to delete distribution record. Please try again.")}},A=e=>{S(O===e?null:e)};return(null===u||void 0===u?void 0:u.distributions)&&u.distributions.reduce((e,t)=>{const a=null!=t.ibadullah_count?t.ibadullah_count:0,n=null!=t.mumin_count?t.mumin_count:0;return{total:e.total+a+n,ibadullah:e.ibadullah+a,mumin:e.mumin+n}},{total:0,ibadullah:0,mumin:0}),r.a.createElement("div",{className:"relative w-full px-4 py-6"},r.a.createElement("img",{src:g.a,alt:"Watermark",className:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",position:"absolute",transform:"translate(-50%, -50%)",width:"70vw",maxWidth:"400px",height:"auto",opacity:.05,zIndex:0}}),r.a.createElement("div",{className:"relative z-10"},r.a.createElement("div",{className:"flex items-center justify-between mb-6"},r.a.createElement("div",{className:"flex items-center"},r.a.createElement("button",{onClick:()=>{a.goBack()},className:"mr-4"},r.a.createElement(s.a,{className:"w-5 h-5 dark:text-white"})),r.a.createElement("h1",{style:{fontSize:window.innerWidth<768?"1.25rem":"1.5rem"},className:"font-semibold dark:text-white"},"Distribution",k&&" - ".concat(k.miqaat_name))),r.a.createElement("button",{onClick:()=>{f(!0)},className:"flex items-center bg-purple-600 text-white rounded-lg",style:{fontSize:window.innerWidth<768?"0.875rem":"1rem",padding:window.innerWidth<768?"0.5rem 1rem":"0.75rem 1rem"}},r.a.createElement(s.e,{className:"mr-1 ".concat(window.innerWidth<768?"w-3 h-3":"w-4 h-4")}),"Add")),E?r.a.createElement("div",{className:"flex justify-center my-8"},r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"Loading data...")):h?r.a.createElement("div",{className:"text-center py-8"},r.a.createElement("p",{className:"text-red-600"},h),r.a.createElement("button",{onClick:z,className:"mt-4 bg-purple-600 text-white px-4 py-2 rounded"},"Retry")):r.a.createElement(r.a.Fragment,null,r.a.createElement(i.TableContainer,{className:"hidden md:block mb-8"},r.a.createElement(i.Table,null,r.a.createElement(i.TableHeader,null,r.a.createElement("tr",null,r.a.createElement(i.TableCell,null,"ID"),r.a.createElement(i.TableCell,null,"Menu"),r.a.createElement(i.TableCell,null,"Quantity"),r.a.createElement(i.TableCell,null,"Ibadullah"),r.a.createElement(i.TableCell,null,"Mumin"),r.a.createElement(i.TableCell,null,"Total"),r.a.createElement(i.TableCell,null,"Zone"),r.a.createElement(i.TableCell,{className:"text-right"},"Actions"))),r.a.createElement(i.TableBody,null,null===u||void 0===u||null===(e=u.distributions)||void 0===e?void 0:e.map((e,t)=>r.a.createElement(i.TableRow,{key:e.id},r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm"},t+1)),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},e.menu_name||"N/A")),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm"},e.quantity||"N/A")),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},null!=e.ibadullah_count?e.ibadullah_count:"N/A")),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm font-medium"},null!=e.mumin_count?e.mumin_count:"N/A")),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm font-bold"},(null!=e.ibadullah_count?e.ibadullah_count:0)+(null!=e.mumin_count?e.mumin_count:0))),r.a.createElement(i.TableCell,null,r.a.createElement("span",{className:"text-sm"},e.zone_name||"N/A")),r.a.createElement(i.TableCell,{className:"text-right"},r.a.createElement("button",{onClick:()=>I(e),className:"text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-500 mr-2"},r.a.createElement(s.d,{className:"h-4 w-4 inline-block"})),r.a.createElement("button",{onClick:()=>T(e.id),className:"text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-500"},r.a.createElement(s.b,{className:"h-4 w-4 inline-block"})))))))),r.a.createElement("div",{className:"md:hidden space-y-3"},(null===u||void 0===u?void 0:u.distributions)&&0!==u.distributions.length?u.distributions.map((e,t)=>r.a.createElement("div",{key:e.id,className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700"},r.a.createElement("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>A(e.id)},r.a.createElement("div",{className:"flex items-center space-x-3"},r.a.createElement("div",{className:"bg-gray-100 dark:bg-gray-700 h-8 w-8 rounded-full flex items-center justify-center text-gray-700 dark:text-gray-300 font-medium"},t+1),r.a.createElement("div",{className:"font-medium text-gray-800 dark:text-gray-200"},e.menu_name||"N/A")),r.a.createElement("button",{onClick:t=>{t.stopPropagation(),A(e.id)},className:"text-gray-600 dark:text-gray-400"},r.a.createElement(s.c,{className:"h-4 w-4 transition-transform ".concat(O===e.id?"rotate-180":"")}))),O===e.id&&r.a.createElement("div",{className:"px-4 pb-4 pt-0 border-t dark:border-gray-700"},r.a.createElement("div",{className:"mt-2 space-y-2"},r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Quantity:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.quantity||"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Ibadullah Count:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},null!=e.ibadullah_count?e.ibadullah_count:"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Mumin Count:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},null!=e.mumin_count?e.mumin_count:"N/A")),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Total Count:"),r.a.createElement("p",{className:"text-sm font-bold text-gray-700 dark:text-gray-300"},(null!=e.ibadullah_count?e.ibadullah_count:0)+(null!=e.mumin_count?e.mumin_count:0))),r.a.createElement("div",null,r.a.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Zone:"),r.a.createElement("p",{className:"text-sm text-gray-700 dark:text-gray-300"},e.zone_name||"N/A"))),r.a.createElement("div",{className:"mt-4 flex justify-end space-x-2"},r.a.createElement("button",{onClick:()=>I(e),className:"text-white px-4 py-1 rounded-md bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 flex items-center"},r.a.createElement(s.d,{className:"h-4 w-4 mr-1"}),"Edit"),r.a.createElement("button",{onClick:()=>T(e.id),className:"text-white px-4 py-1 rounded-md bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 flex items-center"},r.a.createElement(s.b,{className:"h-4 w-4 mr-1"}),"Delete"))))):r.a.createElement("div",{className:"text-center py-8"},r.a.createElement("p",{className:"text-gray-700 dark:text-gray-400"},"No distribution records found")))),v&&r.a.createElement(m,{isOpen:v,onClose:()=>{f(!1)},miqaatId:t,onSuccess:z}),_&&j&&r.a.createElement(b,{isOpen:_,onClose:()=>{w(!1),C(null)},miqaatId:t,distributionData:j,onSuccess:z})))}},40:function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"f",(function(){return i})),a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return u})),a.d(t,"g",(function(){return d}));var n=a(109);let l="https://rms-v2.duckdns.org/api";console.log("Running in Production Mode"),l="https://rms-v2.duckdns.org/api";const r=n.a.create({baseURL:l,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/"),Promise.reject(e)));const c=async(e,t)=>r.get(e,{params:t}).then(e=>e.data),o=async(e,t)=>r.post(e,t).then(e=>e.data),i=async(e,t)=>r.put(e,t).then(e=>e.data),s=async(e,t)=>r.patch(e,t).then(e=>e.data),m=async e=>r.delete(e).then(e=>e.data),u=async(e,t)=>{try{const a=await r.get(e,{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.setAttribute("download",t),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(l)}catch(a){throw console.error("Download failed:",a),a}},d=async(e,t)=>{try{return(await r.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("File upload failed:",a),a}}}}]);
//# sourceMappingURL=26.95bbc385.chunk.js.map